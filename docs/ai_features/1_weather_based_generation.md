# 1. 계절과 날씨를 고려한 문구 추천 기능

## 🎯 기능 목표
교사가 매일 아침 사이트에 들어오면, 오늘 날씨와 계절에 맞는 알림장 문구를 자동으로 추천해주기

## 🌟 사용자 시나리오
1. **오늘 비가 온다면**: "우산 잘 챙기고, 미끄러운 곳 조심하세요"
2. **폭염 주의보가 있다면**: "외출 시 양산 사용하고, 물 자주 마시기"
3. **첫눈이 온다면**: "길이 미끄러우니 천천히 걸어요"
4. **미세먼지가 나쁘다면**: "마스크 착용하고, 실외활동 자제하기"

## 📋 구현 단계

### 1단계: 날씨 정보 가져오기
- 무료 날씨 API 사용 (OpenWeatherMap 등)
- 매일 아침 자동으로 오늘 날씨 확인
- 기온, 날씨 상태, 미세먼지, 특보 정보 수집

### 2단계: 상황별 문구 템플릿 만들기
**비오는 날**
- 우산/우비 준비
- 미끄러짐 주의
- 천둥번개 주의

**더운 날 (28도 이상)**
- 충분한 수분 섭취
- 양산 사용
- 시원한 곳에서 휴식

**추운 날 (5도 이하)**
- 따뜻하게 입기
- 동상 주의
- 실내외 온도차 주의

**미세먼지 나쁨**
- 마스크 착용
- 실외활동 자제
- 환기 시간 조절

### 3단계: AI로 자연스러운 문구 만들기
- 딱딱한 템플릿이 아닌, 자연스러운 문장으로 변환
- 학급 상황에 맞게 톤앤매너 조절
- 매일 다른 표현으로 다양하게 생성

### 4단계: 화면에 표시하기
- 메인 화면 상단에 "오늘의 날씨별 추천" 섹션
- 날씨 아이콘과 함께 문구 표시
- "사용하기" 버튼으로 편집 영역에 바로 추가

## 🛠️ 필요한 도구 (한국 공식 API 우선)
1. **학교 정보**: 교육부 나이스 API (완전 무료)
2. **날씨 정보**: 기상청 API (완전 무료)  
3. **미세먼지**: 환경부 에어코리아 API (완전 무료)
4. **AI 문구 생성**: OpenAI 또는 Claude API
5. **서버 로직**: Supabase Functions

## 📊 예상 효과
- 교사가 매일 날씨 확인하고 문구 고민하는 시간 절약
- 시의적절한 안전 교육 메시지 제공
- 계절감 있는 자연스러운 알림장 작성

## 🚀 개발 우선순위 (수정됨)
**1순위**: 교육부 나이스 API + 기상청 API 연동
**2순위**: 한국형 템플릿 기반 문구 생성 
**3순위**: AI 고도화 (자연스러운 문구, 지역별 특화)

## 📋 실제 구현 플로우

### Phase 1: MVP (기본 기능)
1. **API 계정 설정**
   - data.go.kr에서 기상청 API 키 발급
   - 나이스 API 키 발급
   - 환경부 API 키 발급

2. **학교 검색 기능**
   ```
   사용자 입력: "서울초등학교"
   → 나이스 API 호출
   → 검색 결과 표시
   → 사용자 선택 → 프로필에 저장
   ```

3. **날씨 기반 문구 생성**
   ```
   스케줄러 (매일 새벽 6시):
   1. 전체 사용자 학교 위치 조회
   2. 지역별 그룹핑
   3. 기상청 API로 날씨 수집
   4. 템플릿 기반 문구 생성
   5. blocks 테이블에 저장
   ```

4. **화면 표시**
   - 메인 화면 "오늘의 날씨별 추천" 섹션
   - 🌧️ 아이콘 + 생성된 문구 표시
   - "사용하기" 버튼으로 편집 영역에 추가

### Phase 2: 고도화
1. **AI 문구 생성**: OpenAI로 더 자연스러운 문구
2. **특보 연동**: 폭염특보, 한파특보 등 반영
3. **미세먼지 연동**: 에어코리아 API 추가
4. **지역 특화**: 해안/산간/도심별 맞춤 문구


## 🤔 기술적 검토 및 결정사항

### 1. 사용자별 지역 날씨 정보 수집 방법
**결정: 프로필 기반 학교 위치 설정**

**이유:**
- 교사는 매일 같은 학교에서 근무 → 고정된 위치
- 한 번 설정하면 지속적으로 사용 가능
- 브라우저 위치정보보다 안정적이고 정확함

**구현 방식:**
- 회원가입/프로필 설정 시 근무 학교 검색 및 선택
- 교육부 나이스 API를 통한 정확한 학교 정보 수집
- 학교 주소 → 기상청 격자 좌표 변환 → 날씨 정보 조회

### 2. 서버 vs 클라이언트 로직 처리
**결정: 서버 사이드 처리 (Supabase Functions 활용)**

**이유:**
- API 키 보안 (클라이언트 노출 방지)
- 비용 관리 및 호출량 제어
- 같은 지역 중복 호출 방지 (캐싱)
- 배치 처리로 성능 최적화

**구현 방식:**
- Supabase Functions으로 날씨 수집 및 문구 생성
- 매일 새벽 배치로 미리 생성하여 캐시
- 사용자 접속 시 생성된 문구 즉시 표시

### 3. 데이터베이스 구조
**결정: 기존 blocks 테이블 활용**

**장점:**
- 기존 UI 시스템 그대로 활용 가능
- 검색/필터링/좋아요 기능 재사용
- 코드 복잡도 최소화

**구조:**
```sql
-- 기존 blocks 테이블에 metadata 컬럼 추가
blocks (
  id: UUID,
  title: TEXT,
  content: TEXT,
  tags: TEXT[],
  created_by: UUID, -- 'WEATHER_AI' 등 시스템 계정
  metadata: JSONB,  -- 날씨 정보 저장
  created_at: TIMESTAMP,
  ...
)

-- metadata 예시
{
  "type": "ai_weather",
  "weather_condition": "rain",
  "temperature": 15,
  "region": "seoul_gangnam",
  "generated_date": "2025-09-01"
}
```

## 🇰🇷 한국형 API 활용 계획

### 사용할 공식 API들 (모두 무료)

1. **교육부 나이스 API** - 학교 정보
   - URL: `https://open.neis.go.kr/portal/main.do`
   - 기능: 학교명 검색 → 정확한 주소, 위치 정보
   - 장점: 공식 데이터, 100% 정확도, 완전 무료

2. **기상청 API** - 날씨 정보  
   - URL: `https://www.data.go.kr` (기상청 단기예보)
   - 기능: 실시간 날씨, 기온, 강수확률, 특보 정보
   - 장점: 한국 날씨 전문, 격자 기반 정확한 예보

3. **환경부 에어코리아 API** - 미세먼지
   - URL: `https://www.data.go.kr` (대기오염정보)
   - 기능: 실시간 미세먼지, PM2.5, 오존 농도
   - 장점: 환경부 공식 데이터, 실시간 업데이트

### 한국 특화 문구 생성

**기상 특보별 맞춤 문구:**
- 폭염특보: "양산 사용, 충분한 수분 섭취"
- 한파특보: "따뜻하게 입고, 동상 주의"  
- 태풍특보: "외출 자제, 안전한 곳에서 대기"
- 미세먼지 나쁨: "마스크 착용, 실외활동 자제"

**지역별 특색 반영:**
- 해안 지역: 태풍, 해일 관련 안전수칙
- 산간 지역: 대설, 산사태 주의사항
- 도심 지역: 교통, 대기질 관련 내용
