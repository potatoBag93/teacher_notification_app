<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SubTags 테스트</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>SubTags 테스트</h1>
  <button onclick="testSubTags()">SubTags 데이터 확인</button>
  <button onclick="addNewNoticesWithSubTags()">새 공지 추가 (SubTags 포함)</button>
  <div id="result"></div>

  <script>
    const supabaseUrl = 'https://ofvwlzcipjjvguzjcgem.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mdndsemNpcGpqdmd1empjZ2VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYzMzEyMzQsImV4cCI6MjA1MTkwNzIzNH0.BLb_4sN8w7JIuYvxrL_qx0t0ZcI-3YNy9Z9d4WqfQnE'
    const supabase = supabase.createClient(supabaseUrl, supabaseKey)

    async function testSubTags() {
      try {
        const { data, error } = await supabase
          .from('notices')
          .select('id, title, tags, sub_tags')
          .limit(5)

        console.log('Query result:', { data, error })
        document.getElementById('result').innerHTML = `
          <h3>결과:</h3>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `
      } catch (err) {
        console.error('Error:', err)
        document.getElementById('result').innerHTML = `Error: ${err.message}`
      }
    }

    async function addTestData() {
      try {
        // 기존 데이터에 subTags 추가
        const updates = [
          {
            title: '📱 스마트폰 사용 주의',
            sub_tags: ['사이버안전', '디지털시민의식', '스마트폰중독예방']
          },
          {
            title: '🎉 오늘의 칭찬',
            sub_tags: ['긍정피드백', '학습동기', '자존감향상']
          },
          {
            title: '📚 독서 습관 기르기',
            sub_tags: ['독서교육', '어휘력향상', '집중력강화']
          },
          {
            title: '🥗 건강한 식습관',
            sub_tags: ['영양교육', '편식예방', '성장기건강']
          },
          {
            title: '멀티탭 사용 시 안전사고 예방 안내',
            sub_tags: ['전기안전', '화재예방', '안전수칙']
          }
        ];

        for (const update of updates) {
          const { data, error } = await supabase
            .from('notices')
            .update({ sub_tags: update.sub_tags })
            .eq('title', update.title)
            .select();

          console.log(`Updated ${update.title}:`, { data, error });
        }

        document.getElementById('result').innerHTML = `
          <h3>기존 데이터 업데이트 완료!</h3>
          <p>총 ${updates.length}개 공지에 subTags 추가됨</p>
        `;
      } catch (err) {
        console.error('Error:', err)
        document.getElementById('result').innerHTML = `Error: ${err.message}`
      }
    }

    async function addMoreSubTags() {
      try {
        const moreUpdates = [
          {
            title: '🌿 상쾌한 기온',
            sub_tags: ['날씨정보', '야외활동', '건강관리']
          },
          {
            title: '☀️ 좋은 날씨',
            sub_tags: ['날씨정보', '기분좋은하루', '야외수업']
          },
          {
            title: '특별실 수업 전 교실 정돈 안내',
            sub_tags: ['교실관리', '수업준비', '환경정리']
          },
          {
            title: '여름철 물놀이 안전수칙',
            sub_tags: ['물놀이안전', '여름철주의', '응급처치']
          }
        ];

        for (const update of moreUpdates) {
          const { data, error } = await supabase
            .from('notices')
            .update({ sub_tags: update.sub_tags })
            .eq('title', update.title)
            .select();

          console.log(`Updated ${update.title}:`, { data, error });
        }

        document.getElementById('result').innerHTML = `
          <h3>추가 데이터 업데이트 완료!</h3>
          <p>총 ${moreUpdates.length}개 공지에 subTags 추가됨</p>
        `;
      } catch (err) {
        console.error('Error:', err)
        document.getElementById('result').innerHTML = `Error: ${err.message}`
      }
    }
  </script>
</body>
</html>
