<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚ ì”¨ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ìƒì„±ê¸°</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            padding: 30px;
        }
        
        .workflow-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            gap: 10px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            border-radius: 8px;
            background: #e9ecef;
            color: #6c757d;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .step.completed {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        .step.processing {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .form-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input[type="text"]:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        .suggestions {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            background: white;
            display: none;
            position: relative;
            z-index: 1000;
        }
        
        .info-display {
            display: none;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .school-info {
            background: #e8f5e8;
            border: 1px solid #4caf50;
        }
        
        .location-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
        }
        
        .weather-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 10px;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .weather-icon {
            font-size: 48px;
        }
        
        .weather-temp {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .weather-desc {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .weather-location {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .weather-detail-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .weather-detail-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .weather-detail-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .notices-container {
            display: none;
        }
        
        .notice-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #4caf50;
        }
        
        .notice-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .notice-icon {
            font-size: 24px;
        }
        
        .notice-title {
            flex: 1;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .notice-priority {
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .priority-1 { background: #f44336; }
        .priority-2 { background: #ff9800; }
        .priority-3 { background: #4caf50; }
        
        .notice-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .notice-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #888;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .controls {
            margin-top: 30px;
            text-align: center;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .response-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
            display: none;
        }
        
        .response-area.loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .response-area.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .response-area.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ« ë‚ ì”¨ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ìƒì„±ê¸°</h1>
            <p>í•™êµ ê²€ìƒ‰ â†’ ìœ„ì¹˜ ë³€í™˜ â†’ ë‚ ì”¨ ì¡°íšŒ â†’ ê³µì§€ì‚¬í•­ ìƒì„±</p>
        </div>
        
        <div class="content">
            <!-- ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ í‘œì‹œ -->
            <div class="workflow-steps">
                <div class="step active" id="step-1">
                    <div>1ï¸âƒ£ í•™êµ ê²€ìƒ‰</div>
                </div>
                <div class="step" id="step-2">
                    <div>2ï¸âƒ£ ìœ„ì¹˜ ë³€í™˜</div>
                </div>
                <div class="step" id="step-3">
                    <div>3ï¸âƒ£ ë‚ ì”¨ ì¡°íšŒ</div>
                </div>
                <div class="step" id="step-4">
                    <div>4ï¸âƒ£ ê³µì§€ì‚¬í•­ ìƒì„±</div>
                </div>
            </div>
            
            <!-- í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„° ì„¹ì…˜ -->
            <div class="form-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h3 style="color: white;">ğŸ§ª í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°</h3>
                <p style="margin-bottom: 20px; opacity: 0.9;">ë‹¤ì–‘í•œ ë‚ ì”¨ ìƒí™©ì—ì„œ ê³µì§€ì‚¬í•­ ìƒì„±ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" style="background: #ff6b6b;" onclick="testWeatherScenario('heatwave')">
                        ğŸŒ¡ï¸ í­ì—¼ (35Â°C)
                    </button>
                    <button class="btn" style="background: #4ecdc4;" onclick="testWeatherScenario('cold')">
                        ğŸ¥¶ í˜¹í•œ (-5Â°C)
                    </button>
                    <button class="btn" style="background: #45b7d1;" onclick="testWeatherScenario('heavyrain')">
                        ğŸŒŠ í­ìš° (25mm/h)
                    </button>
                    <button class="btn" style="background: #a8e6cf;" onclick="testWeatherScenario('snow')">
                        â›„ ëˆˆ (ì ì„¤)
                    </button>
                    <button class="btn" style="background: #ffd93d;" onclick="testWeatherScenario('wind')">
                        ğŸ’¨ ê°•í’ (15m/s)
                    </button>
                    <button class="btn" style="background: #ff8a65;" onclick="testWeatherScenario('humid')">
                        ğŸ’§ ê³ ìŠµë„ (90%)
                    </button>
                    <button class="btn" style="background: #81c784;" onclick="testWeatherScenario('normal')">
                        ğŸŒ¤ï¸ í‰ìƒì‹œ (22Â°C)
                    </button>
                </div>
            </div>
            
            <!-- 1ë‹¨ê³„: í•™êµ ê²€ìƒ‰ -->
            <div class="form-section">
                <h3>ğŸ” 1ë‹¨ê³„: í•™êµ ê²€ìƒ‰</h3>
                <div class="form-group">
                    <label for="school-search">í•™êµëª…ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                    <input type="text" id="school-search" placeholder="ì˜ˆ: ëª©í¬ì²­í˜¸ì´ˆë“±í•™êµ">
                    <div id="school-suggestions" class="suggestions"></div>
                </div>
            </div>
            
            <!-- ì„ íƒëœ í•™êµ ì •ë³´ -->
            <div id="selected-school" class="info-display school-info">
                <h3>ğŸ« ì„ íƒëœ í•™êµ ì •ë³´</h3>
                <div id="school-details"></div>
            </div>
            
            <!-- 2ë‹¨ê³„: ìœ„ì¹˜ ì •ë³´ -->
            <div id="location-info" class="info-display location-info">
                <h3>ğŸ“ 2ë‹¨ê³„: ìœ„ì¹˜ ì •ë³´</h3>
                <div id="location-details"></div>
            </div>
            
            <!-- 3ë‹¨ê³„: ë‚ ì”¨ ì •ë³´ -->
            <div id="weather-info" class="info-display weather-info">
                <h3>ğŸŒ¤ï¸ 3ë‹¨ê³„: ë‚ ì”¨ ì •ë³´</h3>
                <div id="weather-details"></div>
            </div>
            
            <!-- 4ë‹¨ê³„: ìƒì„±ëœ ê³µì§€ì‚¬í•­ -->
            <div id="notices-container" class="notices-container">
                <h3>ğŸ“‹ 4ë‹¨ê³„: ë‚ ì”¨ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ì¶”ì²œ</h3>
                <div id="weather-status-message" style="margin-bottom: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
                <div id="notices-list"></div>
            </div>
            
            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
            <div class="controls">
                <button class="btn" id="run-workflow" onclick="runWorkflow()" disabled>
                    ğŸš€ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
                </button>
                <button class="btn btn-secondary" onclick="resetWorkflow()">
                    ğŸ”„ ì´ˆê¸°í™”
                </button>
            </div>
            
            <div id="response-area" class="response-area"></div>
        </div>
    </div>

    <script>
        // ì„¤ì •
        const SUPABASE_URL = 'https://unjxokjoytbwkqmqidni.supabase.co';
        
        // ì „ì—­ ë³€ìˆ˜
        let selectedSchool = null;
        let locationData = null;
        let weatherData = null;
        let searchTimeout;
        
        // ë”ë¯¸ ë‚ ì”¨ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        function createDummyWeatherData(scenario) {
            const baseData = {
                date: new Date().toISOString().split('T')[0],
                time: '1500',
                gridX: 50,
                gridY: 67,
                address: "í…ŒìŠ¤íŠ¸ í•™êµ"
            };
            
            switch (scenario) {
                case 'heatwave':
                    return {
                        ...baseData,
                        temperature: 35,
                        humidity: 65,
                        precipitation: 0,
                        windSpeed: 3,
                        skyCondition: 'clear',
                        skyDescription: 'ë§‘ìŒ',
                        precipitationType: 'none',
                        precipitationDescription: 'ì—†ìŒ'
                    };
                    
                case 'cold':
                    return {
                        ...baseData,
                        temperature: -5,
                        humidity: 70,
                        precipitation: 0,
                        windSpeed: 8,
                        skyCondition: 'cloudy',
                        skyDescription: 'íë¦¼',
                        precipitationType: 'none',
                        precipitationDescription: 'ì—†ìŒ'
                    };
                    
                case 'heavyrain':
                    return {
                        ...baseData,
                        temperature: 23,
                        humidity: 95,
                        precipitation: 25,
                        windSpeed: 7,
                        skyCondition: 'rainy',
                        skyDescription: 'ë¹„',
                        precipitationType: 'rain',
                        precipitationDescription: 'ë¹„'
                    };
                    
                case 'snow':
                    return {
                        ...baseData,
                        temperature: -2,
                        humidity: 85,
                        precipitation: 5,
                        windSpeed: 4,
                        skyCondition: 'snowy',
                        skyDescription: 'ëˆˆ',
                        precipitationType: 'snow',
                        precipitationDescription: 'ëˆˆ'
                    };
                    
                case 'wind':
                    return {
                        ...baseData,
                        temperature: 18,
                        humidity: 60,
                        precipitation: 0,
                        windSpeed: 15,
                        skyCondition: 'cloudy',
                        skyDescription: 'íë¦¼',
                        precipitationType: 'none',
                        precipitationDescription: 'ì—†ìŒ'
                    };
                    
                case 'humid':
                    return {
                        ...baseData,
                        temperature: 29,
                        humidity: 90,
                        precipitation: 0,
                        windSpeed: 2,
                        skyCondition: 'partly_cloudy',
                        skyDescription: 'êµ¬ë¦„ë§ìŒ',
                        precipitationType: 'none',
                        precipitationDescription: 'ì—†ìŒ'
                    };
                    
                case 'normal':
                default:
                    return {
                        ...baseData,
                        temperature: 22,
                        humidity: 60,
                        precipitation: 0,
                        windSpeed: 3,
                        skyCondition: 'clear',
                        skyDescription: 'ë§‘ìŒ',
                        precipitationType: 'none',
                        precipitationDescription: 'ì—†ìŒ'
                    };
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ í•¨ìˆ˜
        function testWeatherScenario(scenario) {
            // ë”ë¯¸ í•™êµ ë°ì´í„° ì„¤ì •
            selectedSchool = {
                SCHUL_NM: "í…ŒìŠ¤íŠ¸ ì´ˆë“±í•™êµ",
                ORG_RDNMA: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…ŒìŠ¤íŠ¸ë¡œ 123",
                SCHUL_KND_SC_NM: "ì´ˆë“±í•™êµ",
                LCTN_SC_NM: "ì„œìš¸"
            };
            
            // ë”ë¯¸ ìœ„ì¹˜ ë°ì´í„° ì„¤ì •
            locationData = {
                address: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…ŒìŠ¤íŠ¸ë¡œ 123",
                latitude: 37.5665,
                longitude: 126.9780,
                gridX: 60,
                gridY: 127
            };
            
            // ë”ë¯¸ ë‚ ì”¨ ë°ì´í„° ìƒì„±
            weatherData = createDummyWeatherData(scenario);
            
            // UI ì—…ë°ì´íŠ¸
            displaySelectedSchool(selectedSchool);
            displayLocationInfo(locationData);
            displayWeatherInfo(weatherData);
            
            // ë‹¨ê³„ ì—…ë°ì´íŠ¸
            updateStep(1, 'completed');
            updateStep(2, 'completed'); 
            updateStep(3, 'completed');
            updateStep(4, 'processing');
            
            // ê³µì§€ì‚¬í•­ ìƒì„±
            setTimeout(() => {
                const generatedNotices = generateWeatherNotices(weatherData);
                
                if (generatedNotices && generatedNotices.length > 0) {
                    displayNotices(generatedNotices);
                    updateStep(4, 'completed');
                    showResponse(`âœ… ${getScenarioName(scenario)} í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n${generatedNotices.length}ê°œì˜ ê³µì§€ì‚¬í•­ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    displayNoNoticeMessage();
                    updateStep(4, 'completed');
                    showResponse(`âœ… ${getScenarioName(scenario)} í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\nê³µì§€ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•Šì€ ë‚ ì”¨ì…ë‹ˆë‹¤.`, 'success');
                }
            }, 1000);
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ ì´ë¦„ ë°˜í™˜ í•¨ìˆ˜
        function getScenarioName(scenario) {
            const names = {
                'heatwave': 'í­ì—¼',
                'cold': 'í˜¹í•œ',
                'heavyrain': 'í­ìš°', 
                'snow': 'ëˆˆ',
                'wind': 'ê°•í’',
                'humid': 'ê³ ìŠµë„',
                'normal': 'í‰ìƒì‹œ'
            };
            return names[scenario] || 'í…ŒìŠ¤íŠ¸';
        }
        
        // ë‹¨ê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStep(stepNumber, status) {
            const step = document.getElementById(`step-${stepNumber}`);
            if (!step) return;
            
            // ëª¨ë“  ë‹¨ê³„ ì´ˆê¸°í™”
            for (let i = 1; i <= 4; i++) {
                const s = document.getElementById(`step-${i}`);
                if (s) {
                    s.className = 'step';
                }
            }
            
            // ì™„ë£Œëœ ë‹¨ê³„ë“¤ í‘œì‹œ
            for (let i = 1; i < stepNumber; i++) {
                const s = document.getElementById(`step-${i}`);
                if (s) {
                    s.className = 'step completed';
                }
            }
            
            // í˜„ì¬ ë‹¨ê³„ í‘œì‹œ
            if (status === 'active') {
                step.className = 'step active';
            } else if (status === 'completed') {
                step.className = 'step completed';
            } else if (status === 'processing') {
                step.className = 'step processing';
            }
        }
        
        // ì‘ë‹µ í‘œì‹œ í•¨ìˆ˜
        function showResponse(message, type) {
            const responseArea = document.getElementById('response-area');
            const timestamp = new Date().toLocaleString('ko-KR', { hour12: false });
            
            responseArea.textContent = `[${timestamp}] ${message}`;
            responseArea.className = `response-area ${type}`;
            responseArea.style.display = 'block';
        }
        
        // í•™êµ ê²€ìƒ‰ ìë™ì™„ì„±
        document.getElementById('school-search').addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            clearTimeout(searchTimeout);
            
            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    searchSchools(query);
                }, 500);
            } else {
                hideSchoolSuggestions();
            }
        });
        
        // í•™êµ ê²€ìƒ‰
        async function searchSchools(query) {
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/search-schools`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ schoolName: query, limit: 10 })
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    displaySchoolSuggestions(result.schools);
                } else {
                    hideSchoolSuggestions();
                }
            } catch (error) {
                console.error('í•™êµ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                hideSchoolSuggestions();
            }
        }
        
        // í•™êµ ìë™ì™„ì„± ì œì•ˆ í‘œì‹œ
        function displaySchoolSuggestions(schools) {
            const suggestionsContainer = document.getElementById('school-suggestions');
            
            if (schools.length === 0) {
                hideSchoolSuggestions();
                return;
            }
            
            suggestionsContainer.innerHTML = '';
            
            schools.forEach(school => {
                const suggestionItem = document.createElement('div');
                suggestionItem.style.cssText = `
                    padding: 12px;
                    cursor: pointer;
                    border-bottom: 1px solid #f0f0f0;
                    transition: background-color 0.2s;
                `;
                
                suggestionItem.innerHTML = `
                    <div style="font-weight: bold; color: #333; margin-bottom: 3px;">${school.SCHUL_NM}</div>
                    <div style="font-size: 12px; color: #666;">${school.SCHUL_KND_SC_NM} | ${school.LCTN_SC_NM} | ${school.ORG_RDNMA || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</div>
                `;
                
                suggestionItem.addEventListener('mouseenter', () => {
                    suggestionItem.style.backgroundColor = '#f5f5f5';
                });
                
                suggestionItem.addEventListener('mouseleave', () => {
                    suggestionItem.style.backgroundColor = 'white';
                });
                
                suggestionItem.addEventListener('click', () => {
                    selectSchool(school);
                });
                
                suggestionsContainer.appendChild(suggestionItem);
            });
            
            suggestionsContainer.style.display = 'block';
        }
        
        // í•™êµ ì„ íƒ
        function selectSchool(school) {
            document.getElementById('school-search').value = school.SCHUL_NM;
            hideSchoolSuggestions();
            
            selectedSchool = school;
            displaySelectedSchool(school);
            updateStep(1, 'completed');
            updateStep(2, 'active');
            
            // ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('run-workflow').disabled = false;
        }
        
        // ì„ íƒëœ í•™êµ ì •ë³´ í‘œì‹œ
        function displaySelectedSchool(school) {
            const container = document.getElementById('selected-school');
            const details = document.getElementById('school-details');
            
            details.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>ğŸ« í•™êµëª…:</strong> ${school.SCHUL_NM}</div>
                <div style="margin-bottom: 5px;"><strong>ğŸ“ ì£¼ì†Œ:</strong> ${school.ORG_RDNMA || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</div>
                <div style="margin-bottom: 5px;"><strong>ğŸ“ ìœ í˜•:</strong> ${school.SCHUL_KND_SC_NM}</div>
                <div><strong>ğŸ—ºï¸ ì§€ì—­:</strong> ${school.LCTN_SC_NM}</div>
            `;
            
            container.style.display = 'block';
        }
        
        // ìë™ì™„ì„± ìˆ¨ê¸°ê¸°
        function hideSchoolSuggestions() {
            document.getElementById('school-suggestions').style.display = 'none';
        }
        
        // ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
        function displayLocationInfo(location) {
            const container = document.getElementById('location-info');
            const details = document.getElementById('location-details');
            
            details.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>ğŸ“ ì£¼ì†Œ:</strong> ${location.address}</div>
                <div style="margin-bottom: 5px;"><strong>ğŸŒ ì¢Œí‘œ:</strong> ${location.latitude}, ${location.longitude}</div>
                <div><strong>ğŸ“ ê¸°ìƒì²­ ê²©ì:</strong> nx=${location.gridX}, ny=${location.gridY}</div>
            `;
            
            container.style.display = 'block';
        }
        
        // ë‚ ì”¨ ì •ë³´ í‘œì‹œ
        function displayWeatherInfo(weather) {
            const container = document.getElementById('weather-info');
            const details = document.getElementById('weather-details');
            
            const getWeatherIcon = (condition) => {
                const iconMap = {
                    'ë§‘ìŒ': 'â˜€ï¸', 'clear': 'â˜€ï¸',
                    'êµ¬ë¦„ë§ìŒ': 'â›…', 'partly_cloudy': 'â›…',
                    'íë¦¼': 'â˜ï¸', 'cloudy': 'â˜ï¸',
                    'ë¹„': 'ğŸŒ§ï¸', 'rainy': 'ğŸŒ§ï¸',
                    'ëˆˆ': 'â„ï¸', 'snowy': 'â„ï¸'
                };
                return iconMap[condition] || 'ğŸŒ¤ï¸';
            };
            
            details.innerHTML = `
                <div class="weather-main">
                    <div class="weather-icon">${getWeatherIcon(weather.skyCondition || weather.skyDescription)}</div>
                    <div>
                        <div class="weather-temp">${weather.temperature}Â°C</div>
                        <div class="weather-desc">${weather.skyDescription}</div>
                        <div class="weather-location">ğŸ“ ${weather.address || selectedSchool.SCHUL_NM}</div>
                    </div>
                </div>
                
                <div class="weather-details">
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">ìŠµë„</div>
                        <div class="weather-detail-value">${weather.humidity || 'N/A'}%</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">í’ì†</div>
                        <div class="weather-detail-value">${weather.windSpeed || 'N/A'}m/s</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">ê°•ìˆ˜ëŸ‰</div>
                        <div class="weather-detail-value">${weather.precipitation || 'N/A'}mm</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">ê°•ìˆ˜í˜•íƒœ</div>
                        <div class="weather-detail-value">${weather.precipitationDescription}</div>
                    </div>
                </div>
            `;
            
            container.style.display = 'block';
        }
        
        // ê³µì§€ì‚¬í•­ í‘œì‹œ
        function displayNotices(notices) {
            const container = document.getElementById('notices-container');
            const list = document.getElementById('notices-list');
            
            list.innerHTML = '';
            
            const priorityText = { 1: 'ê¸´ê¸‰', 2: 'ì£¼ì˜', 3: 'ì •ë³´' };
            
            notices.forEach(notice => {
                const noticeCard = document.createElement('div');
                noticeCard.className = 'notice-card';
                noticeCard.style.borderLeftColor = notice.priority === 1 ? '#f44336' : notice.priority === 2 ? '#ff9800' : '#4caf50';
                
                noticeCard.innerHTML = `
                    <div class="notice-header">
                        <span class="notice-icon">${notice.icon}</span>
                        <h4 class="notice-title">${notice.title}</h4>
                        <span class="notice-priority priority-${notice.priority}">
                            ${priorityText[notice.priority]}
                        </span>
                    </div>
                    <div class="notice-content">${notice.content}</div>
                    <div class="notice-footer">
                        <span>ì¹´í…Œê³ ë¦¬: ${notice.category}</span>
                        <span>ë‚ ì§œ: ${notice.date}</span>
                    </div>
                `;
                
                list.appendChild(noticeCard);
            });
            
            container.style.display = 'block';
        }
        
        // ê³µì§€ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•Šì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
        function displayNoNoticeMessage() {
            const container = document.getElementById('notices-container');
            const list = document.getElementById('notices-list');
            
            list.innerHTML = `
                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px; border: 2px dashed #28a745;">
                    <div style="font-size: 48px; margin-bottom: 15px;">â˜€ï¸</div>
                    <h3 style="color: #28a745; margin-bottom: 10px;">ë‚ ì”¨ ê³µì§€ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h3>
                    <p style="color: #6c757d; margin: 0;">
                        ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ì£¼ì˜ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•Šì€ ì¢‹ì€ ë‚ ì”¨ì…ë‹ˆë‹¤.<br>
                        í•™ìƒë“¤ì´ ì•ˆì „í•˜ê³  ì¦ê²ê²Œ í•™êµìƒí™œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            `;
            
            container.style.display = 'block';
        }
        
        // notices.ts í˜•íƒœì˜ ê³µì§€ì‚¬í•­ ìƒì„± í•¨ìˆ˜
        function createNoticeFromTemplate(templateData, weatherData) {
            return {
                id: templateData.id || `weather-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                title: templateData.title,
                content: templateData.content,
                tags: templateData.tags || ['ë‚ ì”¨', 'ì•Œë¦¼'],
                author: templateData.author || 'AI ë‚ ì”¨ ì•Œë¦¼',
                likeCount: templateData.likeCount || 0,
                subItems: templateData.subItems || [],
                createdAt: templateData.createdAt || new Date(),
                isRecommended: templateData.isRecommended || false,
                isPopular: templateData.isPopular || false
            };
        }

        // NoticeCard ì»´í¬ë„ŒíŠ¸ í˜•íƒœë¡œ HTML ìƒì„±
        function createNoticeCardHTML(notice) {
            const formatDate = (date) => {
                const now = new Date();
                const diffInHours = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60));
                
                if (diffInHours < 1) {
                    return 'ë°©ê¸ˆ ì „';
                } else if (diffInHours < 24) {
                    return `${diffInHours}ì‹œê°„ ì „`;
                } else {
                    const diffInDays = Math.floor(diffInHours / 24);
                    return `${diffInDays}ì¼ ì „`;
                }
            };

            const tagsHTML = notice.tags.map(tag => 
                `<span class="category-tag tag-${tag}" style="background: #3b82f6; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 4px;">${tag}</span>`
            ).join('');

            const subItemsHTML = notice.subItems.map(item => 
                `<li style="margin-bottom: 4px;">${item}</li>`
            ).join('');

            const badgesHTML = `
                ${notice.isRecommended ? '<span class="recommended-badge" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500;">ì˜¤ëŠ˜ ì¶”ì²œ</span>' : ''}
                ${notice.isPopular ? '<span class="popular-badge" style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500;">ì¸ê¸°</span>' : ''}
            `;

            return `
                <div class="notice-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 12px 0; background: white; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                    <div class="notice-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; gap: 8px;">
                        <div class="notice-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                            ${tagsHTML}
                        </div>
                        <div class="notice-meta" style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
                            ${badgesHTML}
                            <span class="like-count" style="color: #ef4444; font-size: 14px; font-weight: 500;">â¤ï¸ ${notice.likeCount}</span>
                        </div>
                    </div>

                    <div class="notice-content" style="margin-bottom: 16px;">
                        <h3 class="notice-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 8px; line-height: 1.4;">${notice.title}</h3>
                        <div class="notice-text" style="color: #4b5563; line-height: 1.5; font-size: 14px;">
                            ${notice.content}
                            ${notice.subItems.length > 0 ? `
                                <ul class="notice-sub-items" style="margin-top: 8px; padding-left: 16px; list-style: disc;">
                                    ${subItemsHTML}
                                </ul>
                            ` : ''}
                        </div>
                    </div>

                    <div class="notice-footer" style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #e5e7eb; gap: 16px;">
                        <span class="notice-author" style="color: #6b7280; font-size: 14px; flex: 1;">ğŸ‘¤ ${notice.author}</span>
                        <span class="notice-date" style="color: #9ca3af; font-size: 14px;">â€¢ ${formatDate(notice.createdAt)}</span>
                        
                        <div class="notice-actions" style="display: flex; gap: 8px;">
                            <button onclick="copyNotice('${notice.id}')" style="background: transparent; border: 1px solid #d1d5db; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">ğŸ“‹ ë³µì‚¬</button>
                            <button onclick="saveNotice('${notice.id}')" style="background: transparent; border: 1px solid #d1d5db; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">â­ ì €ì¥</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ë‚ ì”¨ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ìƒì„± í•¨ìˆ˜
        function generateWeatherNotices(weatherData) {
            const notices = [];
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            
            // ë‹¤ì–‘í•œ ë¬¸êµ¬ ëª¨ìŒ
            const noticeTemplates = {
                heatwave: [
                    {
                        title: "í­ì—¼ ì£¼ì˜ë³´ ë°œë ¹",
                        content: `ì˜¤ëŠ˜ ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cê¹Œì§€ ì˜¬ë¼ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤. ë¬¼ì„ ìì£¼ ë§ˆì‹œê³ , ì•¼ì™¸í™œë™ ì‹œì—ëŠ” ê·¸ëŠ˜ì—ì„œ ì¶©ë¶„íˆ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”. ì–´ì§€ëŸ½ê±°ë‚˜ ì†ì´ ë©”ìŠ¤êº¼ìš°ë©´ ì¦‰ì‹œ ì„ ìƒë‹˜ì—ê²Œ ì•Œë ¤ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸŒ¡ï¸"
                    },
                    {
                        title: "ë¬´ë”ìœ„ íŠ¹ë³´ - ê±´ê°• ê´€ë¦¬ í•„ìˆ˜",
                        content: `ì˜¤ëŠ˜ ìµœê³ ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. ì‹œì›í•œ ë¬¼ì„ ì¶©ë¶„íˆ ë§ˆì‹œê³ , ëª¨ìë‚˜ ì–‘ì‚°ì„ ê¼­ ì±™ê¸°ì„¸ìš”. ì²´ìœ¡ì‹œê°„ì—ëŠ” ë¬´ë¦¬í•˜ì§€ ë§ê³ , ëª¸ì´ ì´ìƒí•˜ë©´ ë°”ë¡œ ì‰¬ì–´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 1, icon: "ğŸ”¥"
                    },
                    {
                        title: "ê·¹ì‹¬í•œ ë”ìœ„ ì£¼ì˜",
                        content: `ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cê¹Œì§€ ì¹˜ì†Ÿì„ ì˜ˆì •ì…ë‹ˆë‹¤. ëƒ‰ìˆ˜ë¥¼ ìì£¼ ë§ˆì‹œê³ , ì‹¤ë‚´ì—ì„œ ì£¼ë¡œ í™œë™í•˜ì„¸ìš”. ë•€ì„ ë§ì´ í˜ë¦¬ë©´ ì†Œê¸ˆë¬¼ì„ ë§ˆì‹œëŠ” ê²ƒë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.`,
                        category: "ì•ˆì „", priority: 1, icon: "â˜€ï¸"
                    },
                    {
                        title: "í­ì—¼ ëŒ€ë¹„ ì•ˆì „ìˆ˜ì¹™",
                        content: `ì˜¤ëŠ˜ì€ ${weatherData.temperature}Â°Cì˜ í­ì—¼ì´ ì˜ˆìƒë©ë‹ˆë‹¤. ë°ì€ ìƒ‰ ì˜·ì„ ì…ê³ , ì„ í¬ë¦¼ì„ ë°œë¼ì£¼ì„¸ìš”. ìš´ë™ì¥ì—ì„œëŠ” ì˜¤ë˜ ë›°ì–´ë†€ì§€ ë§ê³ , ê·¸ëŠ˜ì—ì„œ ìì£¼ ì‰¬ì–´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 1, icon: "ï¿½"
                    },
                    {
                        title: "ì°œí†µë”ìœ„ ì£¼ì˜ë³´",
                        content: `${weatherData.temperature}Â°Cì˜ ë¬´ë”ìš´ ë‚ ì”¨ì…ë‹ˆë‹¤. ë¬¼ë³‘ì„ ê¼­ ì¤€ë¹„í•´ì˜¤ê³ , ëª©ì´ ë§ˆë¥´ê¸° ì „ì— ë¯¸ë¦¬ë¯¸ë¦¬ ë¬¼ì„ ë§ˆì„¸ìš”. ì—ì–´ì»¨ì´ ìˆëŠ” ê³³ì—ì„œ ì¶©ë¶„íˆ ì‰¬ì–´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.`,
                        category: "ê±´ê°•", priority: 1, icon: "ğŸ¥µ"
                    }
                ],
                hot: [
                    {
                        title: "ë¬´ë”ìœ„ ì•ˆì „ìˆ˜ì¹™",
                        content: `ì˜¤ëŠ˜ ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ë†’ìŠµë‹ˆë‹¤. ë¬¼í†µì„ ê¼­ ì¤€ë¹„í•´ ì˜¤ì‹œê³ , ì²´ìœ¡ì‹œê°„ì—ëŠ” ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”. í–‡ë³•ì´ ê°•í•˜ë‹ˆ ëª¨ìë‚˜ ì–‘ì‚°ì„ ì±™ê²¨ì˜¤ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.`,
                        category: "ê±´ê°•", priority: 2, icon: "â˜€ï¸"
                    },
                    {
                        title: "ë”ìš´ ë‚ ì”¨ ê±´ê°• ê´€ë¦¬",
                        content: `ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ì˜¬ë¼ê°‘ë‹ˆë‹¤. ì‹œì›í•œ ìŒë£Œë¥¼ ìì£¼ ë§ˆì‹œê³ , ë•€ì„ ë§ì´ í˜ë¦¬ë©´ ê¹¨ë—í•œ ìˆ˜ê±´ìœ¼ë¡œ ë‹¦ì•„ì£¼ì„¸ìš”. ì ì‹¬ì‹œê°„ì—ëŠ” ì‹œì›í•œ ê³³ì—ì„œ ì‰¬ì–´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸŒ¡ï¸"
                    },
                    {
                        title: "ì—¬ë¦„ì²  ì£¼ì˜ì‚¬í•­",
                        content: `ì˜¤ëŠ˜ ìµœê³ ê¸°ì˜¨ ${weatherData.temperature}Â°Cì˜ ë”ìš´ ë‚ ì”¨ì…ë‹ˆë‹¤. ëƒ‰ìˆ˜ë¥¼ ì¤€ë¹„í•´ì˜¤ì‹œê³ , ì•¼ì™¸í™œë™ í›„ì—ëŠ” ê¼­ ì†ë°œì„ ì‹œì›í•˜ê²Œ ì”»ì–´ì£¼ì„¸ìš”. ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ìœ¼ë©´ ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸ–ï¸"
                    }
                ],
                cold: [
                    {
                        title: "í˜¹ë…í•œ ì¶”ìœ„ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ë§¤ìš° ì¶¥ìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ì™¸íˆ¬ì™€ ì¥ê°‘, ëª©ë„ë¦¬ë¥¼ ê¼­ ì°©ìš©í•˜ê³  ë“±êµí•˜ì„¸ìš”. ì†ë°œì´ ë„ˆë¬´ ì°¨ê°‘ê±°ë‚˜ ì•„í”„ë©´ ë°”ë¡œ ë”°ëœ»í•œ ê³³ìœ¼ë¡œ ë“¤ì–´ê°€ ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸ¥¶"
                    },
                    {
                        title: "í•œíŒŒ íŠ¹ë³´ - ë™ìƒ ì£¼ì˜",
                        content: `ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cê¹Œì§€ ë–¨ì–´ì§‘ë‹ˆë‹¤. ê·€ë§ˆê°œì™€ ì¥ê°‘ì„ ê¼­ ì°©ìš©í•˜ê³ , ì…ê¹€ì´ í•˜ì–—ê²Œ ë‚˜ì˜¬ ì •ë„ë¡œ ì¶¥ìŠµë‹ˆë‹¤. ëª¸ì´ ë–¨ë¦¬ë©´ ì¦‰ì‹œ ì‹¤ë‚´ë¡œ ë“¤ì–´ê°€ ëª¸ì„ ë”°ëœ»í•˜ê²Œ í•´ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "â„ï¸"
                    },
                    {
                        title: "ê·¹í•œ ì¶”ìœ„ ëŒ€ë¹„",
                        content: `${weatherData.temperature}Â°Cì˜ í˜¹ë…í•œ ì¶”ìœ„ì…ë‹ˆë‹¤. íŒ¨ë”©ê³¼ í„¸ëª¨ìë¥¼ ì°©ìš©í•˜ê³ , ì½”ì™€ ëº¨ì´ ë¹¨ê°›ê²Œ ë  ì •ë„ë¡œ ì¶¥ìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ìŒë£Œë¥¼ ë§ˆì‹œë©° ì²´ì˜¨ì„ ìœ ì§€í•´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 1, icon: "ğŸ§Š"
                    }
                ],
                chilly: [
                    {
                        title: "ì¶”ìœ„ ëŒ€ë¹„ ì•ˆë‚´",
                        content: `ì˜¤ëŠ˜ ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ì¶¥ìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ì˜·ì„ ì¶©ë¶„íˆ ì…ê³  ë“±êµí•˜ì„¸ìš”. ì‹¤ë‚´ì™€ ì‹¤ì™¸ì˜ ì˜¨ë„ì°¨ê°€ í¬ë‹ˆ ê°ê¸°ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`,
                        category: "ê±´ê°•", priority: 2, icon: "â„ï¸"
                    },
                    {
                        title: "ìŒ€ìŒ€í•œ ë‚ ì”¨ ì•ˆë‚´",
                        content: `ê¸°ì˜¨ì´ ${weatherData.temperature}Â°Cë¡œ ìŒ€ìŒ€í•©ë‹ˆë‹¤. ì¹´ë””ê±´ì´ë‚˜ ê°€ë””ê±´ì„ ì¤€ë¹„í•´ì˜¤ì‹œê³ , ëª©ì´ ì‹œë¦¬ë‹ˆ ëª©ë„ë¦¬ë„ ì±™ê²¨ì£¼ì„¸ìš”. ë”°ëœ»í•œ ì°¨ë¥¼ ë§ˆì‹œë©´ ëª¸ì´ ë”°ëœ»í•´ì§‘ë‹ˆë‹¤.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸ§¥"
                    },
                    {
                        title: "ì´ˆê²¨ìš¸ ë‚ ì”¨ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ ${weatherData.temperature}Â°Cì˜ ì¶”ìš´ ë‚ ì”¨ì…ë‹ˆë‹¤. ë‘êº¼ìš´ ì˜·ì„ ì…ê³ , ì†ì´ ì°¨ê°€ìš°ë©´ ì£¼ë¨¸ë‹ˆì— ë„£ì–´ ë”°ëœ»í•˜ê²Œ í•´ì£¼ì„¸ìš”. ê°ê¸° ì˜ˆë°©ì„ ìœ„í•´ ë”°ëœ»í•˜ê²Œ ì…ì–´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸ‚"
                    }
                ],
                heavyRain: [
                    {
                        title: "í­ìš° ê²½ë³´ - ë“±í•˜êµ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ ì‹œê°„ë‹¹ ${weatherData.precipitation}mmì˜ ë§ì€ ë¹„ê°€ ì˜ˆìƒë©ë‹ˆë‹¤. ìš°ì‚°ê³¼ ìš°ë¹„ë¥¼ ê¼­ ì¤€ë¹„í•˜ê³ , ë“±í•˜êµ ì‹œ ë¬¼ì´ ë§ì´ ê³ ì¸ ê³³ì€ í”¼í•´ì„œ ë‹¤ë‹ˆì„¸ìš”. í•™ë¶€ëª¨ë‹˜ê»˜ì„œëŠ” ê°€ëŠ¥í•˜ë©´ ì°¨ëŸ‰ìœ¼ë¡œ í”½ì—…í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸŒŠ"
                    },
                    {
                        title: "ì§‘ì¤‘í˜¸ìš° íŠ¹ë³´",
                        content: `${weatherData.precipitation}mmì˜ ê°•í•œ ë¹„ê°€ ë‚´ë¦´ ì˜ˆì •ì…ë‹ˆë‹¤. ì¥í™”ì™€ ìš°ë¹„ë¥¼ ì¤€ë¹„í•˜ê³ , ì²œë‘¥ë²ˆê°œê°€ ì¹  ë•ŒëŠ” í° ë‚˜ë¬´ ì•„ë˜ì— ì„œì§€ ë§ˆì„¸ìš”. ë¬¼ì›…ë©ì´ëŠ” ê¹Šì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì¡°ì‹¬í•˜ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "â›ˆï¸"
                    },
                    {
                        title: "ë¬¼í­íƒ„ ì£¼ì˜ë³´",
                        content: `ì‹œê°„ë‹¹ ${weatherData.precipitation}mmì˜ ë¬¼í­íƒ„ì´ ìŸì•„ì§‘ë‹ˆë‹¤. ì™„ì „ë°©ìˆ˜ ìš°ì‚°ì„ ì¤€ë¹„í•˜ê³ , í•˜ìˆ˜êµ¬ë‚˜ ë§¨í™€ ê·¼ì²˜ëŠ” ìœ„í—˜í•˜ë‹ˆ ê°€ê¹Œì´ ê°€ì§€ ë§ˆì„¸ìš”. ì•ˆì „í•œ ê¸¸ë¡œë§Œ ë‹¤ë…€ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸ’§"
                    }
                ],
                rain: [
                    {
                        title: "ë¹„ ì˜¤ëŠ” ë‚  ì•ˆì „ìˆ˜ì¹™",
                        content: "ì˜¤ëŠ˜ ë¹„ê°€ ë‚´ë¦½ë‹ˆë‹¤. ìš°ì‚°ì„ ê¼­ ì±™ê²¨ì˜¤ì‹œê³ , ë“±í•˜êµí•  ë•Œ ë¯¸ë„ëŸ¬ì§€ì§€ ì•Šë„ë¡ ì²œì²œíˆ ê±¸ì–´ì£¼ì„¸ìš”. ì –ì€ ì‹ ë°œì€ ì‹¤ë‚´ì—ì„œ ê°ˆì•„ì‹ ê³ , ê°ê¸°ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ ì¡°ì‹¬í•˜ì„¸ìš”.",
                        category: "ì•ˆì „", priority: 2, icon: "â˜”"
                    },
                    {
                        title: "ìš°ì²œ ì‹œ ì£¼ì˜ì‚¬í•­",
                        content: "ë¹„ê°€ ë‚´ë¦¬ëŠ” í•˜ë£¨ì…ë‹ˆë‹¤. ìš°ì‚°ì„ ì¤€ë¹„í•´ì˜¤ì‹œê³ , êµì‹¤ ë°”ë‹¥ì´ ë¯¸ë„ëŸ¬ìš¸ ìˆ˜ ìˆìœ¼ë‹ˆ ì¡°ì‹¬í•´ì„œ ê±¸ì–´ì£¼ì„¸ìš”. ë¹„ì— ì –ì€ ì˜·ì€ ë¹¨ë¦¬ ê°ˆì•„ì…ì–´ ê°ê¸° ì˜ˆë°©í•˜ì„¸ìš”.",
                        category: "ì•ˆì „", priority: 2, icon: "ğŸŒ§ï¸"
                    },
                    {
                        title: "ì¥ë§ˆì²  ê±´ê°•ê´€ë¦¬",
                        content: "ì´‰ì´‰í•œ ë¹„ê°€ ë‚´ë¦½ë‹ˆë‹¤. ìš°ì‚°ê³¼ ì—¬ë¶„ì˜ ì–‘ë§ì„ ì¤€ë¹„í•´ì£¼ì‹œê³ , ìŠµë„ê°€ ë†’ìœ¼ë‹ˆ ê°œì¸ìœ„ìƒì— ë”ìš± ì‹ ê²½ì¨ì£¼ì„¸ìš”. ë¹„ ì˜¨ í›„ ìš´ë™ì¥ì€ ë¯¸ë„ëŸ¬ìš°ë‹ˆ ì¡°ì‹¬í•˜ì„¸ìš”.",
                        category: "ê±´ê°•", priority: 2, icon: "â˜‚ï¸"
                    }
                ],
                snow: [
                    {
                        title: "ëˆˆ ë‚´ë¦¼ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ ëˆˆì´ ë‚´ë¦´ ì˜ˆì •ì…ë‹ˆë‹¤. ê¸¸ì´ ë¯¸ë„ëŸ¬ìš°ë‹ˆ ì²œì²œíˆ ì¡°ì‹¬í•´ì„œ ê±¸ì–´ì£¼ì„¸ìš”. ëˆˆë†€ì´ë¥¼ í•  ë•Œë„ ì¹œêµ¬ë“¤ê³¼ ë¶€ë”ªíˆì§€ ì•Šë„ë¡ ì•ˆì „í•˜ê²Œ ë†€ê³ , ì†ì´ ë„ˆë¬´ ì°¨ê°€ìš°ë©´ ë”°ëœ»í•œ ê³³ì—ì„œ ë…¹ì—¬ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "â›„"
                    },
                    {
                        title: "ì²«ëˆˆ ì•ˆì „ìˆ˜ì¹™",
                        content: "ì˜ˆìœ ì²«ëˆˆì´ ë‚´ë¦½ë‹ˆë‹¤. ê³„ë‹¨ê³¼ ìš´ë™ì¥ì´ ë¯¸ë„ëŸ¬ìš°ë‹ˆ ë›°ì–´ë‹¤ë‹ˆì§€ ë§ê³  ì¡°ì‹¬ì¡°ì‹¬ ê±¸ì–´ì£¼ì„¸ìš”. ëˆˆì‚¬ëŒì„ ë§Œë“  í›„ì—ëŠ” ì†ì„ ê¹¨ë—ì´ ì”»ê³ , ëˆˆì„ ì…ì— ë„£ì§€ ë§ˆì„¸ìš”.",
                        category: "ì•ˆì „", priority: 1, icon: "â„ï¸"
                    },
                    {
                        title: "ì„¤í™” ì£¼ì˜ë³´",
                        content: "í•˜ì–€ ëˆˆì´ í„í„ ë‚´ë¦½ë‹ˆë‹¤. ë°©í•œìš©í’ˆì„ ê¼­ ì°©ìš©í•˜ê³ , ëˆˆê¸¸ì—ì„œëŠ” ê¸‰í•˜ê²Œ ë›°ì§€ ë§ˆì„¸ìš”. ëˆˆì‹¸ì›€ì„ í•  ë•ŒëŠ” ì–¼êµ´ì„ ê²¨ëƒ¥í•˜ì§€ ë§ê³ , ì•ˆì „í•˜ê²Œ ë†€ì•„ì£¼ì„¸ìš”.",
                        category: "ì•ˆì „", priority: 1, icon: "â˜ƒï¸"
                    }
                ],
                strongWind: [
                    {
                        title: "ê°•í’ ê²½ë³´ - ì™¸ì¶œ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ í’ì† ${weatherData.windSpeed}m/sì˜ ë§¤ìš° ê°•í•œ ë°”ëŒì´ ë¶ˆ ì˜ˆì •ì…ë‹ˆë‹¤. ë“±í•˜êµ ì‹œ ë‚ ì•„ë‹¤ë‹ˆëŠ” ë¬¼ê±´ì— ë§ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ê³ , ì²´ìœ¡ì‹œê°„ì´ë‚˜ ì‰¬ëŠ” ì‹œê°„ì—ëŠ” ì‹¤ë‚´ì—ì„œë§Œ í™œë™í•´ ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸ’¨"
                    },
                    {
                        title: "íƒœí’ê¸‰ ê°•í’ ì£¼ì˜",
                        content: `í’ì† ${weatherData.windSpeed}m/sì˜ ìœ„í—˜í•œ ë°”ëŒì´ ë¶‘ë‹ˆë‹¤. ëª¨ìë‚˜ ê°€ë°©ì´ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ê½‰ ì¡ê³ , í° ë‚˜ë¬´ë‚˜ ê°„íŒ ì•„ë˜ë¡œ ì§€ë‚˜ê°€ì§€ ë§ˆì„¸ìš”. ì•ˆì „í•œ ì‹¤ë‚´ì—ì„œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 1, icon: "ğŸŒªï¸"
                    }
                ],
                wind: [
                    {
                        title: "ë°”ëŒ ë§ì€ ë‚  ì£¼ì˜ì‚¬í•­",
                        content: `ì˜¤ëŠ˜ í’ì† ${weatherData.windSpeed}m/sì˜ ë°”ëŒì´ ë¶ˆ ì˜ˆì •ì…ë‹ˆë‹¤. ëª¨ìë‚˜ ê°€ë²¼ìš´ ë¬¼ê±´ë“¤ì´ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ì˜ ì±™ê¸°ì‹œê³ , ìš´ë™ì¥ì—ì„œ í™œë™í•  ë•ŒëŠ” ë¨¼ì§€ê°€ ë‚ ë¦´ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”.`,
                        category: "ì•ˆì „", priority: 2, icon: "ğŸŒ¬ï¸"
                    },
                    {
                        title: "ì‚°ë“¤ë°”ëŒ ì£¼ì˜",
                        content: `ë°”ëŒì´ ${weatherData.windSpeed}m/së¡œ ê½¤ ê°•í•˜ê²Œ ë¶‘ë‹ˆë‹¤. ì¢…ì´ë‚˜ íœ´ì§€ê°€ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ì˜ ë³´ê´€í•˜ê³ , ì²´ìœ¡ì‹œê°„ì—ëŠ” ë°”ëŒì˜ ë°©í–¥ì„ ê³ ë ¤í•´ì„œ í™œë™í•´ì£¼ì„¸ìš”.`,
                        category: "ìƒí™œ", priority: 2, icon: "ğŸƒ"
                    }
                ],
                humid: [
                    {
                        title: "ë¬´ë”ìœ„ì™€ ë†’ì€ ìŠµë„ ì£¼ì˜",
                        content: `ì˜¤ëŠ˜ ìŠµë„ê°€ ${weatherData.humidity}%ë¡œ ë§¤ìš° ë†’ì•„ ëˆì ëˆì í•˜ê³  ë‹µë‹µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ì„ ìì£¼ ë§ˆì‹œê³ , ë•€ì„ ë§ì´ í˜ë¦¬ë©´ ê¹¨ë—í•œ ìˆ˜ê±´ìœ¼ë¡œ ë‹¦ì•„ì£¼ì„¸ìš”. ì»¨ë””ì…˜ì´ ì¢‹ì§€ ì•Šìœ¼ë©´ ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸ’§"
                    },
                    {
                        title: "í›„ë¥ì§€ê·¼í•œ ë‚ ì”¨",
                        content: `ìŠµë„ ${weatherData.humidity}%ì˜ í›„ë¥ì§€ê·¼í•œ ë‚ ì”¨ì…ë‹ˆë‹¤. í†µí’ì´ ì˜ ë˜ëŠ” ì˜·ì„ ì…ê³ , ìì£¼ í™˜ê¸°í•´ì£¼ì„¸ìš”. ë•€ë ê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ê¹¨ë—í•˜ê²Œ ì”»ê³ , ì‹œì›í•œ ê³³ì—ì„œ ì‰¬ì–´ì£¼ì„¸ìš”.`,
                        category: "ê±´ê°•", priority: 2, icon: "ğŸŒ«ï¸"
                    }
                ]
            };
            
            // ì˜¨ë„ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ì„ íƒ
            if (weatherData.temperature >= 33) {
                const templates = noticeTemplates.heatwave;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature >= 28) {
                const templates = noticeTemplates.hot;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature <= 0) {
                const templates = noticeTemplates.cold;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature <= 5) {
                const templates = noticeTemplates.chilly;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // ê°•ìˆ˜ëŸ‰ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ì„ íƒ
            if (weatherData.precipitation >= 20) {
                const templates = noticeTemplates.heavyRain;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.precipitation > 0) {
                if (weatherData.precipitationDescription === 'ëˆˆ' || weatherData.precipitationDescription.includes('ëˆˆ')) {
                    const templates = noticeTemplates.snow;
                    const selected = templates[Math.floor(Math.random() * templates.length)];
                    notices.push({ ...selected, date: dateString });
                } else {
                    const templates = noticeTemplates.rain;
                    const selected = templates[Math.floor(Math.random() * templates.length)];
                    notices.push({ ...selected, date: dateString });
                }
            }
            
            // í’ì† ê¸°ë°˜ ê³µì§€ì‚¬í•­ ì„ íƒ
            if (weatherData.windSpeed >= 14) {
                const templates = noticeTemplates.strongWind;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.windSpeed >= 10) {
                const templates = noticeTemplates.wind;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // ìŠµë„ ê¸°ë°˜ ê³µì§€ì‚¬í•­ ì„ íƒ (85% ì´ìƒì¼ ë•Œë§Œ)
            if (weatherData.humidity >= 85) {
                const templates = noticeTemplates.humid;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // íŠ¹ë³„í•œ ì¡°ê±´ì´ ì—†ìœ¼ë©´ ê³µì§€ì‚¬í•­ ìƒì„±í•˜ì§€ ì•ŠìŒ
            if (notices.length === 0) {
                // í‰ìƒì‹œì—ëŠ” ê³µì§€ì‚¬í•­ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ
                return [];
            }
            
            // ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì •ë ¬í•˜ê³  ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ë°˜í™˜
            return notices.sort((a, b) => a.priority - b.priority).slice(0, 3);
        }
        
        // ì „ì²´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
        async function runWorkflow() {
            if (!selectedSchool?.ORG_RDNMA) {
                showResponse('ë¨¼ì € í•™êµë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            showResponse('í•™êµ â†’ ìœ„ì¹˜ â†’ ë‚ ì”¨ â†’ ê³µì§€ì‚¬í•­ ìƒì„± í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'loading');
            
            try {
                // 2ë‹¨ê³„: ìœ„ì¹˜ ì •ë³´ ì¡°íšŒ
                updateStep(2, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const locationResponse = await fetch(`${SUPABASE_URL}/functions/v1/geocode-address`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: selectedSchool.ORG_RDNMA })
                });

                const locationResult = await locationResponse.json();
                
                if (!locationResponse.ok || !locationResult.success) {
                    throw new Error('ìœ„ì¹˜ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ' + (locationResult.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
                
                locationData = locationResult.location;
                displayLocationInfo(locationData);
                updateStep(2, 'completed');
                updateStep(3, 'active');
                
                // 3ë‹¨ê³„: ë‚ ì”¨ ì •ë³´ ì¡°íšŒ
                updateStep(3, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const weatherResponse = await fetch(`${SUPABASE_URL}/functions/v1/get-weather-by-grid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lat: locationData.latitude,
                        lng: locationData.longitude,
                        address: selectedSchool.SCHUL_NM
                    })
                });

                const weatherResult = await weatherResponse.json();
                
                if (!weatherResponse.ok || !weatherResult.success) {
                    throw new Error('ë‚ ì”¨ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ' + (weatherResult.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
                
                weatherData = weatherResult.weather;
                displayWeatherInfo(weatherData);
                updateStep(3, 'completed');
                updateStep(4, 'active');
                
                // 4ë‹¨ê³„: ê³µì§€ì‚¬í•­ ìƒì„±
                updateStep(4, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const generatedNotices = generateWeatherNotices(weatherData);
                
                if (generatedNotices && generatedNotices.length > 0) {
                    displayNotices(generatedNotices);
                    updateStep(4, 'completed');
                    showResponse('âœ… ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!\në‚ ì”¨ ìƒí™©ì— ë§ëŠ” ê³µì§€ì‚¬í•­ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    // ê³µì§€ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•Šì€ ë‚ ì”¨
                    displayNoNoticeMessage();
                    updateStep(4, 'completed');
                    showResponse('âœ… ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!\nì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ë‚ ì”¨ ê³µì§€ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•Šì€ ë‚ ì”¨ì…ë‹ˆë‹¤.', 'success');
                }
                
            } catch (error) {
                showResponse(`âŒ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜!\n\n${error.message}`, 'error');
                console.error('Workflow error:', error);
            }
        }
        
        // ì›Œí¬í”Œë¡œìš° ì´ˆê¸°í™”
        function resetWorkflow() {
            document.getElementById('school-search').value = '';
            hideSchoolSuggestions();
            
            selectedSchool = null;
            locationData = null;
            weatherData = null;
            
            document.getElementById('selected-school').style.display = 'none';
            document.getElementById('location-info').style.display = 'none';
            document.getElementById('weather-info').style.display = 'none';
            document.getElementById('notices-container').style.display = 'none';
            document.getElementById('response-area').style.display = 'none';
            
            document.getElementById('run-workflow').disabled = true;
            
            updateStep(1, 'active');
        }
        
        // ì™¸ë¶€ í´ë¦­ ì‹œ ìë™ì™„ì„± ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#school-search') && !e.target.closest('#school-suggestions')) {
                hideSchoolSuggestions();
            }
        });
    </script>
</body>
</html>
