<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇ†Ïî® Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±Í∏∞</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            padding: 30px;
        }
        
        .workflow-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            gap: 10px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            border-radius: 8px;
            background: #e9ecef;
            color: #6c757d;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .step.completed {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        .step.processing {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .form-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input[type="text"]:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        .suggestions {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            background: white;
            display: none;
            position: relative;
            z-index: 1000;
        }
        
        .info-display {
            display: none;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .school-info {
            background: #e8f5e8;
            border: 1px solid #4caf50;
        }
        
        .location-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
        }
        
        .weather-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 10px;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .weather-icon {
            font-size: 48px;
        }
        
        .weather-temp {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .weather-desc {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .weather-location {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .weather-detail-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .weather-detail-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .weather-detail-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .notices-container {
            display: none;
        }
        
        .notice-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #4caf50;
        }
        
        .notice-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .notice-icon {
            font-size: 24px;
        }
        
        .notice-title {
            flex: 1;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .notice-priority {
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .priority-1 { background: #f44336; }
        .priority-2 { background: #ff9800; }
        .priority-3 { background: #4caf50; }
        
        .notice-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .notice-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #888;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .controls {
            margin-top: 30px;
            text-align: center;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .response-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
            display: none;
        }
        
        .response-area.loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .response-area.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .response-area.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè´ ÎÇ†Ïî® Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±Í∏∞</h1>
            <p>ÌïôÍµê Í≤ÄÏÉâ ‚Üí ÏúÑÏπò Î≥ÄÌôò ‚Üí ÎÇ†Ïî® Ï°∞Ìöå ‚Üí Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±</p>
        </div>
        
        <div class="content">
            <!-- ÏõåÌÅ¨ÌîåÎ°úÏö∞ Îã®Í≥Ñ ÌëúÏãú -->
            <div class="workflow-steps">
                <div class="step active" id="step-1">
                    <div>1Ô∏è‚É£ ÌïôÍµê Í≤ÄÏÉâ</div>
                </div>
                <div class="step" id="step-2">
                    <div>2Ô∏è‚É£ ÏúÑÏπò Î≥ÄÌôò</div>
                </div>
                <div class="step" id="step-3">
                    <div>3Ô∏è‚É£ ÎÇ†Ïî® Ï°∞Ìöå</div>
                </div>
                <div class="step" id="step-4">
                    <div>4Ô∏è‚É£ Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±</div>
                </div>
            </div>
            
            <!-- ÌÖåÏä§Ìä∏Ïö© ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞ ÏÑπÏÖò -->
            <div class="form-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h3 style="color: white;">üß™ ÌÖåÏä§Ìä∏Ïö© ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞</h3>
                <p style="margin-bottom: 20px; opacity: 0.9;">Îã§ÏñëÌïú ÎÇ†Ïî® ÏÉÅÌô©ÏóêÏÑú Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±ÏùÑ ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" style="background: #ff6b6b;" onclick="testWeatherScenario('heatwave')">
                        üå°Ô∏è Ìè≠Ïóº (35¬∞C)
                    </button>
                    <button class="btn" style="background: #4ecdc4;" onclick="testWeatherScenario('cold')">
                        ü•∂ ÌòπÌïú (-5¬∞C)
                    </button>
                    <button class="btn" style="background: #45b7d1;" onclick="testWeatherScenario('heavyrain')">
                        üåä Ìè≠Ïö∞ (25mm/h)
                    </button>
                    <button class="btn" style="background: #a8e6cf;" onclick="testWeatherScenario('snow')">
                        ‚õÑ Îàà (Ï†ÅÏÑ§)
                    </button>
                    <button class="btn" style="background: #ffd93d;" onclick="testWeatherScenario('wind')">
                        üí® Í∞ïÌíç (15m/s)
                    </button>
                    <button class="btn" style="background: #ff8a65;" onclick="testWeatherScenario('humid')">
                        üíß Í≥†ÏäµÎèÑ (90%)
                    </button>
                    <button class="btn" style="background: #81c784;" onclick="testWeatherScenario('normal')">
                        üå§Ô∏è ÌèâÏÉÅÏãú (22¬∞C)
                    </button>
                </div>
            </div>
            
            <!-- 1Îã®Í≥Ñ: ÌïôÍµê Í≤ÄÏÉâ -->
            <div class="form-section">
                <h3>üîç 1Îã®Í≥Ñ: ÌïôÍµê Í≤ÄÏÉâ</h3>
                <div class="form-group">
                    <label for="school-search">ÌïôÍµêÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:</label>
                    <input type="text" id="school-search" placeholder="Ïòà: Î™©Ìè¨Ï≤≠Ìò∏Ï¥àÎì±ÌïôÍµê">
                    <div id="school-suggestions" class="suggestions"></div>
                </div>
            </div>
            
            <!-- ÏÑ†ÌÉùÎêú ÌïôÍµê Ï†ïÎ≥¥ -->
            <div id="selected-school" class="info-display school-info">
                <h3>üè´ ÏÑ†ÌÉùÎêú ÌïôÍµê Ï†ïÎ≥¥</h3>
                <div id="school-details"></div>
            </div>
            
            <!-- 2Îã®Í≥Ñ: ÏúÑÏπò Ï†ïÎ≥¥ -->
            <div id="location-info" class="info-display location-info">
                <h3>üìç 2Îã®Í≥Ñ: ÏúÑÏπò Ï†ïÎ≥¥</h3>
                <div id="location-details"></div>
            </div>
            
            <!-- 3Îã®Í≥Ñ: ÎÇ†Ïî® Ï†ïÎ≥¥ -->
            <div id="weather-info" class="info-display weather-info">
                <h3>üå§Ô∏è 3Îã®Í≥Ñ: ÎÇ†Ïî® Ï†ïÎ≥¥</h3>
                <div id="weather-details"></div>
            </div>
            
            <!-- 4Îã®Í≥Ñ: ÏÉùÏÑ±Îêú Í≥µÏßÄÏÇ¨Ìï≠ -->
            <div id="notices-container" class="notices-container">
                <h3>üìã 4Îã®Í≥Ñ: ÎÇ†Ïî® Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ Ï∂îÏ≤ú</h3>
                <div id="weather-status-message" style="margin-bottom: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
                <div id="notices-list"></div>
            </div>
            
            <!-- Ïª®Ìä∏Î°§ Î≤ÑÌäº -->
            <div class="controls">
                <button class="btn" id="run-workflow" onclick="runWorkflow()" disabled>
                    üöÄ Ï†ÑÏ≤¥ ÌîÑÎ°úÏÑ∏Ïä§ Ïã§Ìñâ
                </button>
                <button class="btn btn-secondary" onclick="resetWorkflow()">
                    üîÑ Ï¥àÍ∏∞Ìôî
                </button>
            </div>
            
            <div id="response-area" class="response-area"></div>
        </div>
    </div>

    <script>
        // ÏÑ§Ï†ï
        const SUPABASE_URL = 'https://unjxokjoytbwkqmqidni.supabase.co';
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let selectedSchool = null;
        let locationData = null;
        let weatherData = null;
        let searchTimeout;
        
        // ÎçîÎØ∏ ÎÇ†Ïî® Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ìï®Ïàò
        function createDummyWeatherData(scenario) {
            const baseData = {
                date: new Date().toISOString().split('T')[0],
                time: '1500',
                gridX: 50,
                gridY: 67,
                address: "ÌÖåÏä§Ìä∏ ÌïôÍµê"
            };
            
            switch (scenario) {
                case 'heatwave':
                    return {
                        ...baseData,
                        temperature: 35,
                        humidity: 65,
                        precipitation: 0,
                        windSpeed: 3,
                        skyCondition: 'clear',
                        skyDescription: 'ÎßëÏùå',
                        precipitationType: 'none',
                        precipitationDescription: 'ÏóÜÏùå'
                    };
                    
                case 'cold':
                    return {
                        ...baseData,
                        temperature: -5,
                        humidity: 70,
                        precipitation: 0,
                        windSpeed: 8,
                        skyCondition: 'cloudy',
                        skyDescription: 'ÌùêÎ¶º',
                        precipitationType: 'none',
                        precipitationDescription: 'ÏóÜÏùå'
                    };
                    
                case 'heavyrain':
                    return {
                        ...baseData,
                        temperature: 23,
                        humidity: 95,
                        precipitation: 25,
                        windSpeed: 7,
                        skyCondition: 'rainy',
                        skyDescription: 'ÎπÑ',
                        precipitationType: 'rain',
                        precipitationDescription: 'ÎπÑ'
                    };
                    
                case 'snow':
                    return {
                        ...baseData,
                        temperature: -2,
                        humidity: 85,
                        precipitation: 5,
                        windSpeed: 4,
                        skyCondition: 'snowy',
                        skyDescription: 'Îàà',
                        precipitationType: 'snow',
                        precipitationDescription: 'Îàà'
                    };
                    
                case 'wind':
                    return {
                        ...baseData,
                        temperature: 18,
                        humidity: 60,
                        precipitation: 0,
                        windSpeed: 15,
                        skyCondition: 'cloudy',
                        skyDescription: 'ÌùêÎ¶º',
                        precipitationType: 'none',
                        precipitationDescription: 'ÏóÜÏùå'
                    };
                    
                case 'humid':
                    return {
                        ...baseData,
                        temperature: 29,
                        humidity: 90,
                        precipitation: 0,
                        windSpeed: 2,
                        skyCondition: 'partly_cloudy',
                        skyDescription: 'Íµ¨Î¶ÑÎßéÏùå',
                        precipitationType: 'none',
                        precipitationDescription: 'ÏóÜÏùå'
                    };
                    
                case 'normal':
                default:
                    return {
                        ...baseData,
                        temperature: 22,
                        humidity: 60,
                        precipitation: 0,
                        windSpeed: 3,
                        skyCondition: 'clear',
                        skyDescription: 'ÎßëÏùå',
                        precipitationType: 'none',
                        precipitationDescription: 'ÏóÜÏùå'
                    };
            }
        }
        
        // ÌÖåÏä§Ìä∏ ÏãúÎÇòÎ¶¨Ïò§ Ïã§Ìñâ Ìï®Ïàò
        function testWeatherScenario(scenario) {
            // ÎçîÎØ∏ ÌïôÍµê Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
            selectedSchool = {
                SCHUL_NM: "ÌÖåÏä§Ìä∏ Ï¥àÎì±ÌïôÍµê",
                ORG_RDNMA: "ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í∞ïÎÇ®Íµ¨ ÌÖåÏä§Ìä∏Î°ú 123",
                SCHUL_KND_SC_NM: "Ï¥àÎì±ÌïôÍµê",
                LCTN_SC_NM: "ÏÑúÏö∏"
            };
            
            // ÎçîÎØ∏ ÏúÑÏπò Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
            locationData = {
                address: "ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í∞ïÎÇ®Íµ¨ ÌÖåÏä§Ìä∏Î°ú 123",
                latitude: 37.5665,
                longitude: 126.9780,
                gridX: 60,
                gridY: 127
            };
            
            // ÎçîÎØ∏ ÎÇ†Ïî® Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            weatherData = createDummyWeatherData(scenario);
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            displaySelectedSchool(selectedSchool);
            displayLocationInfo(locationData);
            displayWeatherInfo(weatherData);
            
            // Îã®Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            updateStep(1, 'completed');
            updateStep(2, 'completed'); 
            updateStep(3, 'completed');
            updateStep(4, 'processing');
            
            // Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±
            setTimeout(() => {
                const generatedNotices = generateWeatherNotices(weatherData);
                
                if (generatedNotices && generatedNotices.length > 0) {
                    displayNotices(generatedNotices);
                    updateStep(4, 'completed');
                    showResponse(`‚úÖ ${getScenarioName(scenario)} ÌÖåÏä§Ìä∏ ÏôÑÎ£å!\n${generatedNotices.length}Í∞úÏùò Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`, 'success');
                } else {
                    displayNoNoticeMessage();
                    updateStep(4, 'completed');
                    showResponse(`‚úÖ ${getScenarioName(scenario)} ÌÖåÏä§Ìä∏ ÏôÑÎ£å!\nÍ≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÄ ÎÇ†Ïî®ÏûÖÎãàÎã§.`, 'success');
                }
            }, 1000);
        }
        
        // ÏãúÎÇòÎ¶¨Ïò§ Ïù¥Î¶Ñ Î∞òÌôò Ìï®Ïàò
        function getScenarioName(scenario) {
            const names = {
                'heatwave': 'Ìè≠Ïóº',
                'cold': 'ÌòπÌïú',
                'heavyrain': 'Ìè≠Ïö∞', 
                'snow': 'Îàà',
                'wind': 'Í∞ïÌíç',
                'humid': 'Í≥†ÏäµÎèÑ',
                'normal': 'ÌèâÏÉÅÏãú'
            };
            return names[scenario] || 'ÌÖåÏä§Ìä∏';
        }
        
        // Îã®Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateStep(stepNumber, status) {
            const step = document.getElementById(`step-${stepNumber}`);
            if (!step) return;
            
            // Î™®Îì† Îã®Í≥Ñ Ï¥àÍ∏∞Ìôî
            for (let i = 1; i <= 4; i++) {
                const s = document.getElementById(`step-${i}`);
                if (s) {
                    s.className = 'step';
                }
            }
            
            // ÏôÑÎ£åÎêú Îã®Í≥ÑÎì§ ÌëúÏãú
            for (let i = 1; i < stepNumber; i++) {
                const s = document.getElementById(`step-${i}`);
                if (s) {
                    s.className = 'step completed';
                }
            }
            
            // ÌòÑÏû¨ Îã®Í≥Ñ ÌëúÏãú
            if (status === 'active') {
                step.className = 'step active';
            } else if (status === 'completed') {
                step.className = 'step completed';
            } else if (status === 'processing') {
                step.className = 'step processing';
            }
        }
        
        // ÏùëÎãµ ÌëúÏãú Ìï®Ïàò
        function showResponse(message, type) {
            const responseArea = document.getElementById('response-area');
            const timestamp = new Date().toLocaleString('ko-KR', { hour12: false });
            
            responseArea.textContent = `[${timestamp}] ${message}`;
            responseArea.className = `response-area ${type}`;
            responseArea.style.display = 'block';
        }
        
        // ÌïôÍµê Í≤ÄÏÉâ ÏûêÎèôÏôÑÏÑ±
        document.getElementById('school-search').addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            clearTimeout(searchTimeout);
            
            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    searchSchools(query);
                }, 500);
            } else {
                hideSchoolSuggestions();
            }
        });
        
        // ÌïôÍµê Í≤ÄÏÉâ
        async function searchSchools(query) {
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/search-schools`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ schoolName: query, limit: 10 })
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    displaySchoolSuggestions(result.schools);
                } else {
                    hideSchoolSuggestions();
                }
            } catch (error) {
                console.error('ÌïôÍµê Í≤ÄÏÉâ Ïò§Î•ò:', error);
                hideSchoolSuggestions();
            }
        }
        
        // ÌïôÍµê ÏûêÎèôÏôÑÏÑ± Ï†úÏïà ÌëúÏãú
        function displaySchoolSuggestions(schools) {
            const suggestionsContainer = document.getElementById('school-suggestions');
            
            if (schools.length === 0) {
                hideSchoolSuggestions();
                return;
            }
            
            suggestionsContainer.innerHTML = '';
            
            schools.forEach(school => {
                const suggestionItem = document.createElement('div');
                suggestionItem.style.cssText = `
                    padding: 12px;
                    cursor: pointer;
                    border-bottom: 1px solid #f0f0f0;
                    transition: background-color 0.2s;
                `;
                
                suggestionItem.innerHTML = `
                    <div style="font-weight: bold; color: #333; margin-bottom: 3px;">${school.SCHUL_NM}</div>
                    <div style="font-size: 12px; color: #666;">${school.SCHUL_KND_SC_NM} | ${school.LCTN_SC_NM} | ${school.ORG_RDNMA || 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå'}</div>
                `;
                
                suggestionItem.addEventListener('mouseenter', () => {
                    suggestionItem.style.backgroundColor = '#f5f5f5';
                });
                
                suggestionItem.addEventListener('mouseleave', () => {
                    suggestionItem.style.backgroundColor = 'white';
                });
                
                suggestionItem.addEventListener('click', () => {
                    selectSchool(school);
                });
                
                suggestionsContainer.appendChild(suggestionItem);
            });
            
            suggestionsContainer.style.display = 'block';
        }
        
        // ÌïôÍµê ÏÑ†ÌÉù
        function selectSchool(school) {
            document.getElementById('school-search').value = school.SCHUL_NM;
            hideSchoolSuggestions();
            
            selectedSchool = school;
            displaySelectedSchool(school);
            updateStep(1, 'completed');
            updateStep(2, 'active');
            
            // Ïã§Ìñâ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.getElementById('run-workflow').disabled = false;
        }
        
        // ÏÑ†ÌÉùÎêú ÌïôÍµê Ï†ïÎ≥¥ ÌëúÏãú
        function displaySelectedSchool(school) {
            const container = document.getElementById('selected-school');
            const details = document.getElementById('school-details');
            
            details.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>üè´ ÌïôÍµêÎ™Ö:</strong> ${school.SCHUL_NM}</div>
                <div style="margin-bottom: 5px;"><strong>üìç Ï£ºÏÜå:</strong> ${school.ORG_RDNMA || 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå'}</div>
                <div style="margin-bottom: 5px;"><strong>üéì Ïú†Ìòï:</strong> ${school.SCHUL_KND_SC_NM}</div>
                <div><strong>üó∫Ô∏è ÏßÄÏó≠:</strong> ${school.LCTN_SC_NM}</div>
            `;
            
            container.style.display = 'block';
        }
        
        // ÏûêÎèôÏôÑÏÑ± Ïà®Í∏∞Í∏∞
        function hideSchoolSuggestions() {
            document.getElementById('school-suggestions').style.display = 'none';
        }
        
        // ÏúÑÏπò Ï†ïÎ≥¥ ÌëúÏãú
        function displayLocationInfo(location) {
            const container = document.getElementById('location-info');
            const details = document.getElementById('location-details');
            
            details.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>üìç Ï£ºÏÜå:</strong> ${location.address}</div>
                <div style="margin-bottom: 5px;"><strong>üåç Ï¢åÌëú:</strong> ${location.latitude}, ${location.longitude}</div>
                <div><strong>üìê Í∏∞ÏÉÅÏ≤≠ Í≤©Ïûê:</strong> nx=${location.gridX}, ny=${location.gridY}</div>
            `;
            
            container.style.display = 'block';
        }
        
        // ÎÇ†Ïî® Ï†ïÎ≥¥ ÌëúÏãú
        function displayWeatherInfo(weather) {
            const container = document.getElementById('weather-info');
            const details = document.getElementById('weather-details');
            
            const getWeatherIcon = (condition) => {
                const iconMap = {
                    'ÎßëÏùå': '‚òÄÔ∏è', 'clear': '‚òÄÔ∏è',
                    'Íµ¨Î¶ÑÎßéÏùå': '‚õÖ', 'partly_cloudy': '‚õÖ',
                    'ÌùêÎ¶º': '‚òÅÔ∏è', 'cloudy': '‚òÅÔ∏è',
                    'ÎπÑ': 'üåßÔ∏è', 'rainy': 'üåßÔ∏è',
                    'Îàà': '‚ùÑÔ∏è', 'snowy': '‚ùÑÔ∏è'
                };
                return iconMap[condition] || 'üå§Ô∏è';
            };
            
            details.innerHTML = `
                <div class="weather-main">
                    <div class="weather-icon">${getWeatherIcon(weather.skyCondition || weather.skyDescription)}</div>
                    <div>
                        <div class="weather-temp">${weather.temperature}¬∞C</div>
                        <div class="weather-desc">${weather.skyDescription}</div>
                        <div class="weather-location">üìç ${weather.address || selectedSchool.SCHUL_NM}</div>
                    </div>
                </div>
                
                <div class="weather-details">
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">ÏäµÎèÑ</div>
                        <div class="weather-detail-value">${weather.humidity || 'N/A'}%</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">ÌíçÏÜç</div>
                        <div class="weather-detail-value">${weather.windSpeed || 'N/A'}m/s</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">Í∞ïÏàòÎüâ</div>
                        <div class="weather-detail-value">${weather.precipitation || 'N/A'}mm</div>
                    </div>
                    <div class="weather-detail-item">
                        <div class="weather-detail-label">Í∞ïÏàòÌòïÌÉú</div>
                        <div class="weather-detail-value">${weather.precipitationDescription}</div>
                    </div>
                </div>
            `;
            
            container.style.display = 'block';
        }
        
        // Í≥µÏßÄÏÇ¨Ìï≠ ÌëúÏãú
        function displayNotices(notices) {
            const container = document.getElementById('notices-container');
            const list = document.getElementById('notices-list');
            
            list.innerHTML = '';
            
            const priorityText = { 1: 'Í∏¥Í∏â', 2: 'Ï£ºÏùò', 3: 'Ï†ïÎ≥¥' };
            
            notices.forEach(notice => {
                const noticeCard = document.createElement('div');
                noticeCard.className = 'notice-card';
                noticeCard.style.borderLeftColor = notice.priority === 1 ? '#f44336' : notice.priority === 2 ? '#ff9800' : '#4caf50';
                
                noticeCard.innerHTML = `
                    <div class="notice-header">
                        <span class="notice-icon">${notice.icon}</span>
                        <h4 class="notice-title">${notice.title}</h4>
                        <span class="notice-priority priority-${notice.priority}">
                            ${priorityText[notice.priority]}
                        </span>
                    </div>
                    <div class="notice-content">${notice.content}</div>
                    <div class="notice-footer">
                        <span>Ïπ¥ÌÖåÍ≥†Î¶¨: ${notice.category}</span>
                        <span>ÎÇ†Ïßú: ${notice.date}</span>
                    </div>
                `;
                
                list.appendChild(noticeCard);
            });
            
            container.style.display = 'block';
        }
        
        // Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÑ Îïå Î©îÏãúÏßÄ ÌëúÏãú
        function displayNoNoticeMessage() {
            const container = document.getElementById('notices-container');
            const list = document.getElementById('notices-list');
            
            list.innerHTML = `
                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px; border: 2px dashed #28a745;">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚òÄÔ∏è</div>
                    <h3 style="color: #28a745; margin-bottom: 10px;">ÎÇ†Ïî® Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏäµÎãàÎã§</h3>
                    <p style="color: #6c757d; margin: 0;">
                        Ïò§ÎäòÏùÄ ÌäπÎ≥ÑÌïú Ï£ºÏùòÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÄ Ï¢ãÏùÄ ÎÇ†Ïî®ÏûÖÎãàÎã§.<br>
                        ÌïôÏÉùÎì§Ïù¥ ÏïàÏ†ÑÌïòÍ≥† Ï¶êÍ≤ÅÍ≤å ÌïôÍµêÏÉùÌôúÏùÑ Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                </div>
            `;
            
            container.style.display = 'block';
        }
        
        // notices.ts ÌòïÌÉúÏùò Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ± Ìï®Ïàò
        function createNoticeFromTemplate(templateData, weatherData) {
            return {
                id: templateData.id || `weather-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                title: templateData.title,
                content: templateData.content,
                tags: templateData.tags || ['ÎÇ†Ïî®', 'ÏïåÎ¶º'],
                author: templateData.author || 'AI ÎÇ†Ïî® ÏïåÎ¶º',
                likeCount: templateData.likeCount || 0,
                subItems: templateData.subItems || [],
                createdAt: templateData.createdAt || new Date(),
                isRecommended: templateData.isRecommended || false,
                isPopular: templateData.isPopular || false
            };
        }

        // NoticeCard Ïª¥Ìè¨ÎÑåÌä∏ ÌòïÌÉúÎ°ú HTML ÏÉùÏÑ±
        function createNoticeCardHTML(notice) {
            const formatDate = (date) => {
                const now = new Date();
                const diffInHours = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60));
                
                if (diffInHours < 1) {
                    return 'Î∞©Í∏à Ï†Ñ';
                } else if (diffInHours < 24) {
                    return `${diffInHours}ÏãúÍ∞Ñ Ï†Ñ`;
                } else {
                    const diffInDays = Math.floor(diffInHours / 24);
                    return `${diffInDays}Ïùº Ï†Ñ`;
                }
            };

            const tagsHTML = notice.tags.map(tag => 
                `<span class="category-tag tag-${tag}" style="background: #3b82f6; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 4px;">${tag}</span>`
            ).join('');

            const subItemsHTML = notice.subItems.map(item => 
                `<li style="margin-bottom: 4px;">${item}</li>`
            ).join('');

            const badgesHTML = `
                ${notice.isRecommended ? '<span class="recommended-badge" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500;">Ïò§Îäò Ï∂îÏ≤ú</span>' : ''}
                ${notice.isPopular ? '<span class="popular-badge" style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500;">Ïù∏Í∏∞</span>' : ''}
            `;

            return `
                <div class="notice-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 12px 0; background: white; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                    <div class="notice-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; gap: 8px;">
                        <div class="notice-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                            ${tagsHTML}
                        </div>
                        <div class="notice-meta" style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
                            ${badgesHTML}
                            <span class="like-count" style="color: #ef4444; font-size: 14px; font-weight: 500;">‚ù§Ô∏è ${notice.likeCount}</span>
                        </div>
                    </div>

                    <div class="notice-content" style="margin-bottom: 16px;">
                        <h3 class="notice-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 8px; line-height: 1.4;">${notice.title}</h3>
                        <div class="notice-text" style="color: #4b5563; line-height: 1.5; font-size: 14px;">
                            ${notice.content}
                            ${notice.subItems.length > 0 ? `
                                <ul class="notice-sub-items" style="margin-top: 8px; padding-left: 16px; list-style: disc;">
                                    ${subItemsHTML}
                                </ul>
                            ` : ''}
                        </div>
                    </div>

                    <div class="notice-footer" style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #e5e7eb; gap: 16px;">
                        <span class="notice-author" style="color: #6b7280; font-size: 14px; flex: 1;">üë§ ${notice.author}</span>
                        <span class="notice-date" style="color: #9ca3af; font-size: 14px;">‚Ä¢ ${formatDate(notice.createdAt)}</span>
                        
                        <div class="notice-actions" style="display: flex; gap: 8px;">
                            <button onclick="copyNotice('${notice.id}')" style="background: transparent; border: 1px solid #d1d5db; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">üìã Î≥µÏÇ¨</button>
                            <button onclick="saveNotice('${notice.id}')" style="background: transparent; border: 1px solid #d1d5db; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">‚≠ê Ï†ÄÏû•</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÎÇ†Ïî® Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ± Ìï®Ïàò
        function generateWeatherNotices(weatherData) {
            const notices = [];
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            
            // Îã§ÏñëÌïú Î¨∏Íµ¨ Î™®Ïùå
            const noticeTemplates = {
                heatwave: [
                    {
                        title: "Ìè≠Ïóº Ï£ºÏùòÎ≥¥ Î∞úÎ†π",
                        content: `Ïò§Îäò Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÍπåÏßÄ Ïò¨ÎùºÍ∞à ÏòàÏ†ïÏûÖÎãàÎã§. Î¨ºÏùÑ ÏûêÏ£º ÎßàÏãúÍ≥†, ÏïºÏô∏ÌôúÎèô ÏãúÏóêÎäî Í∑∏ÎäòÏóêÏÑú Ï∂©Î∂ÑÌûà Ìú¥ÏãùÏùÑ Ï∑®ÌïòÏÑ∏Ïöî. Ïñ¥ÏßÄÎüΩÍ±∞ÎÇò ÏÜçÏù¥ Î©îÏä§Í∫ºÏö∞Î©¥ Ï¶âÏãú ÏÑ†ÏÉùÎãòÏóêÍ≤å ÏïåÎ†§Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "üå°Ô∏è"
                    },
                    {
                        title: "Î¨¥ÎçîÏúÑ ÌäπÎ≥¥ - Í±¥Í∞ï Í¥ÄÎ¶¨ ÌïÑÏàò",
                        content: `Ïò§Îäò ÏµúÍ≥†Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú Îß§Ïö∞ ÎÜíÏäµÎãàÎã§. ÏãúÏõêÌïú Î¨ºÏùÑ Ï∂©Î∂ÑÌûà ÎßàÏãúÍ≥†, Î™®ÏûêÎÇò ÏñëÏÇ∞ÏùÑ Íº≠ Ï±ôÍ∏∞ÏÑ∏Ïöî. Ï≤¥Ïú°ÏãúÍ∞ÑÏóêÎäî Î¨¥Î¶¨ÌïòÏßÄ ÎßêÍ≥†, Î™∏Ïù¥ Ïù¥ÏÉÅÌïòÎ©¥ Î∞îÎ°ú Ïâ¨Ïñ¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 1, icon: "üî•"
                    },
                    {
                        title: "Í∑πÏã¨Ìïú ÎçîÏúÑ Ï£ºÏùò",
                        content: `Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÍπåÏßÄ ÏπòÏÜüÏùÑ ÏòàÏ†ïÏûÖÎãàÎã§. ÎÉâÏàòÎ•º ÏûêÏ£º ÎßàÏãúÍ≥†, Ïã§ÎÇ¥ÏóêÏÑú Ï£ºÎ°ú ÌôúÎèôÌïòÏÑ∏Ïöî. ÎïÄÏùÑ ÎßéÏù¥ ÌùòÎ¶¨Î©¥ ÏÜåÍ∏àÎ¨ºÏùÑ ÎßàÏãúÎäî Í≤ÉÎèÑ ÎèÑÏõÄÏù¥ Îê©ÎãàÎã§.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚òÄÔ∏è"
                    },
                    {
                        title: "Ìè≠Ïóº ÎåÄÎπÑ ÏïàÏ†ÑÏàòÏπô",
                        content: `Ïò§ÎäòÏùÄ ${weatherData.temperature}¬∞CÏùò Ìè≠ÏóºÏù¥ ÏòàÏÉÅÎê©ÎãàÎã§. Î∞ùÏùÄ ÏÉâ Ïò∑ÏùÑ ÏûÖÍ≥†, ÏÑ†ÌÅ¨Î¶ºÏùÑ Î∞úÎùºÏ£ºÏÑ∏Ïöî. Ïö¥ÎèôÏû•ÏóêÏÑúÎäî Ïò§Îûò Îõ∞Ïñ¥ÎÜÄÏßÄ ÎßêÍ≥†, Í∑∏ÎäòÏóêÏÑú ÏûêÏ£º Ïâ¨Ïñ¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 1, icon: "ÔøΩ"
                    },
                    {
                        title: "Ï∞úÌÜµÎçîÏúÑ Ï£ºÏùòÎ≥¥",
                        content: `${weatherData.temperature}¬∞CÏùò Î¨¥ÎçîÏö¥ ÎÇ†Ïî®ÏûÖÎãàÎã§. Î¨ºÎ≥ëÏùÑ Íº≠ Ï§ÄÎπÑÌï¥Ïò§Í≥†, Î™©Ïù¥ ÎßàÎ•¥Í∏∞ Ï†ÑÏóê ÎØ∏Î¶¨ÎØ∏Î¶¨ Î¨ºÏùÑ ÎßàÏÑ∏Ïöî. ÏóêÏñ¥Ïª®Ïù¥ ÏûàÎäî Í≥≥ÏóêÏÑú Ï∂©Î∂ÑÌûà Ïâ¨Ïñ¥Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.`,
                        category: "Í±¥Í∞ï", priority: 1, icon: "ü•µ"
                    }
                ],
                hot: [
                    {
                        title: "Î¨¥ÎçîÏúÑ ÏïàÏ†ÑÏàòÏπô",
                        content: `Ïò§Îäò Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú ÎÜíÏäµÎãàÎã§. Î¨ºÌÜµÏùÑ Íº≠ Ï§ÄÎπÑÌï¥ Ïò§ÏãúÍ≥†, Ï≤¥Ïú°ÏãúÍ∞ÑÏóêÎäî Î¨¥Î¶¨ÌïòÏßÄ ÎßàÏÑ∏Ïöî. ÌñáÎ≥ïÏù¥ Í∞ïÌïòÎãà Î™®ÏûêÎÇò ÏñëÏÇ∞ÏùÑ Ï±ôÍ≤®Ïò§Î©¥ Ï¢ãÍ≤†ÏäµÎãàÎã§.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "‚òÄÔ∏è"
                    },
                    {
                        title: "ÎçîÏö¥ ÎÇ†Ïî® Í±¥Í∞ï Í¥ÄÎ¶¨",
                        content: `Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú Ïò¨ÎùºÍ∞ëÎãàÎã§. ÏãúÏõêÌïú ÏùåÎ£åÎ•º ÏûêÏ£º ÎßàÏãúÍ≥†, ÎïÄÏùÑ ÎßéÏù¥ ÌùòÎ¶¨Î©¥ Íπ®ÎÅóÌïú ÏàòÍ±¥ÏúºÎ°ú Îã¶ÏïÑÏ£ºÏÑ∏Ïöî. Ï†êÏã¨ÏãúÍ∞ÑÏóêÎäî ÏãúÏõêÌïú Í≥≥ÏóêÏÑú Ïâ¨Ïñ¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üå°Ô∏è"
                    },
                    {
                        title: "Ïó¨Î¶ÑÏ≤† Ï£ºÏùòÏÇ¨Ìï≠",
                        content: `Ïò§Îäò ÏµúÍ≥†Í∏∞Ïò® ${weatherData.temperature}¬∞CÏùò ÎçîÏö¥ ÎÇ†Ïî®ÏûÖÎãàÎã§. ÎÉâÏàòÎ•º Ï§ÄÎπÑÌï¥Ïò§ÏãúÍ≥†, ÏïºÏô∏ÌôúÎèô ÌõÑÏóêÎäî Íº≠ ÏÜêÎ∞úÏùÑ ÏãúÏõêÌïòÍ≤å ÏîªÏñ¥Ï£ºÏÑ∏Ïöî. Ïª®ÎîîÏÖòÏù¥ Ïïà Ï¢ãÏúºÎ©¥ Î¨¥Î¶¨ÌïòÏßÄ ÎßàÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üèñÔ∏è"
                    }
                ],
                cold: [
                    {
                        title: "ÌòπÎèÖÌïú Ï∂îÏúÑ Ï£ºÏùò",
                        content: `Ïò§Îäò Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú Îß§Ïö∞ Ï∂•ÏäµÎãàÎã§. Îî∞ÎúªÌïú Ïô∏Ìà¨ÏôÄ Ïû•Í∞ë, Î™©ÎèÑÎ¶¨Î•º Íº≠ Ï∞©Ïö©ÌïòÍ≥† Îì±ÍµêÌïòÏÑ∏Ïöî. ÏÜêÎ∞úÏù¥ ÎÑàÎ¨¥ Ï∞®Í∞ëÍ±∞ÎÇò ÏïÑÌîÑÎ©¥ Î∞îÎ°ú Îî∞ÎúªÌïú Í≥≥ÏúºÎ°ú Îì§Ïñ¥Í∞Ä Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "ü•∂"
                    },
                    {
                        title: "ÌïúÌåå ÌäπÎ≥¥ - ÎèôÏÉÅ Ï£ºÏùò",
                        content: `Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÍπåÏßÄ Îñ®Ïñ¥ÏßëÎãàÎã§. Í∑ÄÎßàÍ∞úÏôÄ Ïû•Í∞ëÏùÑ Íº≠ Ï∞©Ïö©ÌïòÍ≥†, ÏûÖÍπÄÏù¥ ÌïòÏñóÍ≤å ÎÇòÏò¨ Ï†ïÎèÑÎ°ú Ï∂•ÏäµÎãàÎã§. Î™∏Ïù¥ Îñ®Î¶¨Î©¥ Ï¶âÏãú Ïã§ÎÇ¥Î°ú Îì§Ïñ¥Í∞Ä Î™∏ÏùÑ Îî∞ÎúªÌïòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚ùÑÔ∏è"
                    },
                    {
                        title: "Í∑πÌïú Ï∂îÏúÑ ÎåÄÎπÑ",
                        content: `${weatherData.temperature}¬∞CÏùò ÌòπÎèÖÌïú Ï∂îÏúÑÏûÖÎãàÎã§. Ìå®Îî©Í≥º ÌÑ∏Î™®ÏûêÎ•º Ï∞©Ïö©ÌïòÍ≥†, ÏΩîÏôÄ Î∫®Ïù¥ Îπ®Í∞õÍ≤å Îê† Ï†ïÎèÑÎ°ú Ï∂•ÏäµÎãàÎã§. Îî∞ÎúªÌïú ÏùåÎ£åÎ•º ÎßàÏãúÎ©∞ Ï≤¥Ïò®ÏùÑ Ïú†ÏßÄÌï¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 1, icon: "üßä"
                    }
                ],
                chilly: [
                    {
                        title: "Ï∂îÏúÑ ÎåÄÎπÑ ÏïàÎÇ¥",
                        content: `Ïò§Îäò Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú Ï∂•ÏäµÎãàÎã§. Îî∞ÎúªÌïú Ïò∑ÏùÑ Ï∂©Î∂ÑÌûà ÏûÖÍ≥† Îì±ÍµêÌïòÏÑ∏Ïöî. Ïã§ÎÇ¥ÏôÄ Ïã§Ïô∏Ïùò Ïò®ÎèÑÏ∞®Í∞Ä ÌÅ¨Îãà Í∞êÍ∏∞Ïóê Í±∏Î¶¨ÏßÄ ÏïäÎèÑÎ°ù Ï£ºÏùòÌïòÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "‚ùÑÔ∏è"
                    },
                    {
                        title: "ÏåÄÏåÄÌïú ÎÇ†Ïî® ÏïàÎÇ¥",
                        content: `Í∏∞Ïò®Ïù¥ ${weatherData.temperature}¬∞CÎ°ú ÏåÄÏåÄÌï©ÎãàÎã§. Ïπ¥ÎîîÍ±¥Ïù¥ÎÇò Í∞ÄÎîîÍ±¥ÏùÑ Ï§ÄÎπÑÌï¥Ïò§ÏãúÍ≥†, Î™©Ïù¥ ÏãúÎ¶¨Îãà Î™©ÎèÑÎ¶¨ÎèÑ Ï±ôÍ≤®Ï£ºÏÑ∏Ïöî. Îî∞ÎúªÌïú Ï∞®Î•º ÎßàÏãúÎ©¥ Î™∏Ïù¥ Îî∞ÎúªÌï¥ÏßëÎãàÎã§.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üß•"
                    },
                    {
                        title: "Ï¥àÍ≤®Ïö∏ ÎÇ†Ïî® Ï£ºÏùò",
                        content: `Ïò§Îäò ${weatherData.temperature}¬∞CÏùò Ï∂îÏö¥ ÎÇ†Ïî®ÏûÖÎãàÎã§. ÎëêÍ∫ºÏö¥ Ïò∑ÏùÑ ÏûÖÍ≥†, ÏÜêÏù¥ Ï∞®Í∞ÄÏö∞Î©¥ Ï£ºÎ®∏ÎãàÏóê ÎÑ£Ïñ¥ Îî∞ÎúªÌïòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî. Í∞êÍ∏∞ ÏòàÎ∞©ÏùÑ ÏúÑÌï¥ Îî∞ÎúªÌïòÍ≤å ÏûÖÏñ¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üçÇ"
                    }
                ],
                heavyRain: [
                    {
                        title: "Ìè≠Ïö∞ Í≤ΩÎ≥¥ - Îì±ÌïòÍµê Ï£ºÏùò",
                        content: `Ïò§Îäò ÏãúÍ∞ÑÎãπ ${weatherData.precipitation}mmÏùò ÎßéÏùÄ ÎπÑÍ∞Ä ÏòàÏÉÅÎê©ÎãàÎã§. Ïö∞ÏÇ∞Í≥º Ïö∞ÎπÑÎ•º Íº≠ Ï§ÄÎπÑÌïòÍ≥†, Îì±ÌïòÍµê Ïãú Î¨ºÏù¥ ÎßéÏù¥ Í≥†Ïù∏ Í≥≥ÏùÄ ÌîºÌï¥ÏÑú Îã§ÎãàÏÑ∏Ïöî. ÌïôÎ∂ÄÎ™®ÎãòÍªòÏÑúÎäî Í∞ÄÎä•ÌïòÎ©¥ Ï∞®ÎüâÏúºÎ°ú ÌîΩÏóÖÌï¥ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "üåä"
                    },
                    {
                        title: "ÏßëÏ§ëÌò∏Ïö∞ ÌäπÎ≥¥",
                        content: `${weatherData.precipitation}mmÏùò Í∞ïÌïú ÎπÑÍ∞Ä ÎÇ¥Î¶¥ ÏòàÏ†ïÏûÖÎãàÎã§. Ïû•ÌôîÏôÄ Ïö∞ÎπÑÎ•º Ï§ÄÎπÑÌïòÍ≥†, Ï≤úÎë•Î≤àÍ∞úÍ∞Ä Ïπ† ÎïåÎäî ÌÅ∞ ÎÇòÎ¨¥ ÏïÑÎûòÏóê ÏÑúÏßÄ ÎßàÏÑ∏Ïöî. Î¨ºÏõÖÎç©Ïù¥Îäî ÍπäÏùÑ Ïàò ÏûàÏúºÎãà Ï°∞Ïã¨ÌïòÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚õàÔ∏è"
                    },
                    {
                        title: "Î¨ºÌè≠ÌÉÑ Ï£ºÏùòÎ≥¥",
                        content: `ÏãúÍ∞ÑÎãπ ${weatherData.precipitation}mmÏùò Î¨ºÌè≠ÌÉÑÏù¥ ÏèüÏïÑÏßëÎãàÎã§. ÏôÑÏ†ÑÎ∞©Ïàò Ïö∞ÏÇ∞ÏùÑ Ï§ÄÎπÑÌïòÍ≥†, ÌïòÏàòÍµ¨ÎÇò Îß®ÌôÄ Í∑ºÏ≤òÎäî ÏúÑÌóòÌïòÎãà Í∞ÄÍπåÏù¥ Í∞ÄÏßÄ ÎßàÏÑ∏Ïöî. ÏïàÏ†ÑÌïú Í∏∏Î°úÎßå Îã§ÎÖÄÏ£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "üíß"
                    }
                ],
                rain: [
                    {
                        title: "ÎπÑ Ïò§Îäî ÎÇ† ÏïàÏ†ÑÏàòÏπô",
                        content: "Ïò§Îäò ÎπÑÍ∞Ä ÎÇ¥Î¶ΩÎãàÎã§. Ïö∞ÏÇ∞ÏùÑ Íº≠ Ï±ôÍ≤®Ïò§ÏãúÍ≥†, Îì±ÌïòÍµêÌï† Îïå ÎØ∏ÎÅÑÎü¨ÏßÄÏßÄ ÏïäÎèÑÎ°ù Ï≤úÏ≤úÌûà Í±∏Ïñ¥Ï£ºÏÑ∏Ïöî. Ï†ñÏùÄ Ïã†Î∞úÏùÄ Ïã§ÎÇ¥ÏóêÏÑú Í∞àÏïÑÏã†Í≥†, Í∞êÍ∏∞Ïóê Í±∏Î¶¨ÏßÄ ÏïäÎèÑÎ°ù Ï°∞Ïã¨ÌïòÏÑ∏Ïöî.",
                        category: "ÏïàÏ†Ñ", priority: 2, icon: "‚òî"
                    },
                    {
                        title: "Ïö∞Ï≤ú Ïãú Ï£ºÏùòÏÇ¨Ìï≠",
                        content: "ÎπÑÍ∞Ä ÎÇ¥Î¶¨Îäî ÌïòÎ£®ÏûÖÎãàÎã§. Ïö∞ÏÇ∞ÏùÑ Ï§ÄÎπÑÌï¥Ïò§ÏãúÍ≥†, ÍµêÏã§ Î∞îÎã•Ïù¥ ÎØ∏ÎÅÑÎü¨Ïö∏ Ïàò ÏûàÏúºÎãà Ï°∞Ïã¨Ìï¥ÏÑú Í±∏Ïñ¥Ï£ºÏÑ∏Ïöî. ÎπÑÏóê Ï†ñÏùÄ Ïò∑ÏùÄ Îπ®Î¶¨ Í∞àÏïÑÏûÖÏñ¥ Í∞êÍ∏∞ ÏòàÎ∞©ÌïòÏÑ∏Ïöî.",
                        category: "ÏïàÏ†Ñ", priority: 2, icon: "üåßÔ∏è"
                    },
                    {
                        title: "Ïû•ÎßàÏ≤† Í±¥Í∞ïÍ¥ÄÎ¶¨",
                        content: "Ï¥âÏ¥âÌïú ÎπÑÍ∞Ä ÎÇ¥Î¶ΩÎãàÎã§. Ïö∞ÏÇ∞Í≥º Ïó¨Î∂ÑÏùò ÏñëÎßêÏùÑ Ï§ÄÎπÑÌï¥Ï£ºÏãúÍ≥†, ÏäµÎèÑÍ∞Ä ÎÜíÏúºÎãà Í∞úÏù∏ÏúÑÏÉùÏóê ÎçîÏö± Ïã†Í≤ΩÏç®Ï£ºÏÑ∏Ïöî. ÎπÑ Ïò® ÌõÑ Ïö¥ÎèôÏû•ÏùÄ ÎØ∏ÎÅÑÎü¨Ïö∞Îãà Ï°∞Ïã¨ÌïòÏÑ∏Ïöî.",
                        category: "Í±¥Í∞ï", priority: 2, icon: "‚òÇÔ∏è"
                    }
                ],
                snow: [
                    {
                        title: "Îàà ÎÇ¥Î¶º Ï£ºÏùò",
                        content: `Ïò§Îäò ÎààÏù¥ ÎÇ¥Î¶¥ ÏòàÏ†ïÏûÖÎãàÎã§. Í∏∏Ïù¥ ÎØ∏ÎÅÑÎü¨Ïö∞Îãà Ï≤úÏ≤úÌûà Ï°∞Ïã¨Ìï¥ÏÑú Í±∏Ïñ¥Ï£ºÏÑ∏Ïöî. ÎààÎÜÄÏù¥Î•º Ìï† ÎïåÎèÑ ÏπúÍµ¨Îì§Í≥º Î∂ÄÎî™ÌûàÏßÄ ÏïäÎèÑÎ°ù ÏïàÏ†ÑÌïòÍ≤å ÎÜÄÍ≥†, ÏÜêÏù¥ ÎÑàÎ¨¥ Ï∞®Í∞ÄÏö∞Î©¥ Îî∞ÎúªÌïú Í≥≥ÏóêÏÑú ÎÖπÏó¨Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚õÑ"
                    },
                    {
                        title: "Ï≤´Îàà ÏïàÏ†ÑÏàòÏπô",
                        content: "ÏòàÏÅú Ï≤´ÎààÏù¥ ÎÇ¥Î¶ΩÎãàÎã§. Í≥ÑÎã®Í≥º Ïö¥ÎèôÏû•Ïù¥ ÎØ∏ÎÅÑÎü¨Ïö∞Îãà Îõ∞Ïñ¥Îã§ÎãàÏßÄ ÎßêÍ≥† Ï°∞Ïã¨Ï°∞Ïã¨ Í±∏Ïñ¥Ï£ºÏÑ∏Ïöî. ÎààÏÇ¨ÎûåÏùÑ ÎßåÎì† ÌõÑÏóêÎäî ÏÜêÏùÑ Íπ®ÎÅóÏù¥ ÏîªÍ≥†, ÎààÏùÑ ÏûÖÏóê ÎÑ£ÏßÄ ÎßàÏÑ∏Ïöî.",
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚ùÑÔ∏è"
                    },
                    {
                        title: "ÏÑ§Ìôî Ï£ºÏùòÎ≥¥",
                        content: "ÌïòÏñÄ ÎààÏù¥ ÌéÑÌéÑ ÎÇ¥Î¶ΩÎãàÎã§. Î∞©ÌïúÏö©ÌíàÏùÑ Íº≠ Ï∞©Ïö©ÌïòÍ≥†, ÎààÍ∏∏ÏóêÏÑúÎäî Í∏âÌïòÍ≤å Îõ∞ÏßÄ ÎßàÏÑ∏Ïöî. ÎààÏã∏ÏõÄÏùÑ Ìï† ÎïåÎäî ÏñºÍµ¥ÏùÑ Í≤®ÎÉ•ÌïòÏßÄ ÎßêÍ≥†, ÏïàÏ†ÑÌïòÍ≤å ÎÜÄÏïÑÏ£ºÏÑ∏Ïöî.",
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "‚òÉÔ∏è"
                    }
                ],
                strongWind: [
                    {
                        title: "Í∞ïÌíç Í≤ΩÎ≥¥ - Ïô∏Ï∂ú Ï£ºÏùò",
                        content: `Ïò§Îäò ÌíçÏÜç ${weatherData.windSpeed}m/sÏùò Îß§Ïö∞ Í∞ïÌïú Î∞îÎûåÏù¥ Î∂à ÏòàÏ†ïÏûÖÎãàÎã§. Îì±ÌïòÍµê Ïãú ÎÇ†ÏïÑÎã§ÎãàÎäî Î¨ºÍ±¥Ïóê ÎßûÏßÄ ÏïäÎèÑÎ°ù Ï£ºÏùòÌïòÍ≥†, Ï≤¥Ïú°ÏãúÍ∞ÑÏù¥ÎÇò Ïâ¨Îäî ÏãúÍ∞ÑÏóêÎäî Ïã§ÎÇ¥ÏóêÏÑúÎßå ÌôúÎèôÌï¥ Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "üí®"
                    },
                    {
                        title: "ÌÉúÌíçÍ∏â Í∞ïÌíç Ï£ºÏùò",
                        content: `ÌíçÏÜç ${weatherData.windSpeed}m/sÏùò ÏúÑÌóòÌïú Î∞îÎûåÏù¥ Î∂ëÎãàÎã§. Î™®ÏûêÎÇò Í∞ÄÎ∞©Ïù¥ ÎÇ†ÏïÑÍ∞ÄÏßÄ ÏïäÎèÑÎ°ù ÍΩâ Ïû°Í≥†, ÌÅ∞ ÎÇòÎ¨¥ÎÇò Í∞ÑÌåê ÏïÑÎûòÎ°ú ÏßÄÎÇòÍ∞ÄÏßÄ ÎßàÏÑ∏Ïöî. ÏïàÏ†ÑÌïú Ïã§ÎÇ¥ÏóêÏÑú Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 1, icon: "üå™Ô∏è"
                    }
                ],
                wind: [
                    {
                        title: "Î∞îÎûå ÎßéÏùÄ ÎÇ† Ï£ºÏùòÏÇ¨Ìï≠",
                        content: `Ïò§Îäò ÌíçÏÜç ${weatherData.windSpeed}m/sÏùò Î∞îÎûåÏù¥ Î∂à ÏòàÏ†ïÏûÖÎãàÎã§. Î™®ÏûêÎÇò Í∞ÄÎ≤ºÏö¥ Î¨ºÍ±¥Îì§Ïù¥ ÎÇ†ÏïÑÍ∞ÄÏßÄ ÏïäÎèÑÎ°ù Ïûò Ï±ôÍ∏∞ÏãúÍ≥†, Ïö¥ÎèôÏû•ÏóêÏÑú ÌôúÎèôÌï† ÎïåÎäî Î®ºÏßÄÍ∞Ä ÎÇ†Î¶¥ Ïàò ÏûàÏúºÎãà Ï£ºÏùòÌïòÏÑ∏Ïöî.`,
                        category: "ÏïàÏ†Ñ", priority: 2, icon: "üå¨Ô∏è"
                    },
                    {
                        title: "ÏÇ∞Îì§Î∞îÎûå Ï£ºÏùò",
                        content: `Î∞îÎûåÏù¥ ${weatherData.windSpeed}m/sÎ°ú ÍΩ§ Í∞ïÌïòÍ≤å Î∂ëÎãàÎã§. Ï¢ÖÏù¥ÎÇò Ìú¥ÏßÄÍ∞Ä ÎÇ†ÏïÑÍ∞ÄÏßÄ ÏïäÎèÑÎ°ù Ïûò Î≥¥Í¥ÄÌïòÍ≥†, Ï≤¥Ïú°ÏãúÍ∞ÑÏóêÎäî Î∞îÎûåÏùò Î∞©Ìñ•ÏùÑ Í≥†Î†§Ìï¥ÏÑú ÌôúÎèôÌï¥Ï£ºÏÑ∏Ïöî.`,
                        category: "ÏÉùÌôú", priority: 2, icon: "üçÉ"
                    }
                ],
                humid: [
                    {
                        title: "Î¨¥ÎçîÏúÑÏôÄ ÎÜíÏùÄ ÏäµÎèÑ Ï£ºÏùò",
                        content: `Ïò§Îäò ÏäµÎèÑÍ∞Ä ${weatherData.humidity}%Î°ú Îß§Ïö∞ ÎÜíÏïÑ ÎÅàÏ†ÅÎÅàÏ†ÅÌïòÍ≥† ÎãµÎãµÌï† Ïàò ÏûàÏäµÎãàÎã§. Î¨ºÏùÑ ÏûêÏ£º ÎßàÏãúÍ≥†, ÎïÄÏùÑ ÎßéÏù¥ ÌùòÎ¶¨Î©¥ Íπ®ÎÅóÌïú ÏàòÍ±¥ÏúºÎ°ú Îã¶ÏïÑÏ£ºÏÑ∏Ïöî. Ïª®ÎîîÏÖòÏù¥ Ï¢ãÏßÄ ÏïäÏúºÎ©¥ Î¨¥Î¶¨ÌïòÏßÄ ÎßàÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üíß"
                    },
                    {
                        title: "ÌõÑÎç•ÏßÄÍ∑ºÌïú ÎÇ†Ïî®",
                        content: `ÏäµÎèÑ ${weatherData.humidity}%Ïùò ÌõÑÎç•ÏßÄÍ∑ºÌïú ÎÇ†Ïî®ÏûÖÎãàÎã§. ÌÜµÌíçÏù¥ Ïûò ÎêòÎäî Ïò∑ÏùÑ ÏûÖÍ≥†, ÏûêÏ£º ÌôòÍ∏∞Ìï¥Ï£ºÏÑ∏Ïöî. ÎïÄÎù†Í∞Ä ÏÉùÍ∏∞ÏßÄ ÏïäÎèÑÎ°ù Íπ®ÎÅóÌïòÍ≤å ÏîªÍ≥†, ÏãúÏõêÌïú Í≥≥ÏóêÏÑú Ïâ¨Ïñ¥Ï£ºÏÑ∏Ïöî.`,
                        category: "Í±¥Í∞ï", priority: 2, icon: "üå´Ô∏è"
                    }
                ]
            };
            
            // Ïò®ÎèÑ Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÑ†ÌÉù
            if (weatherData.temperature >= 33) {
                const templates = noticeTemplates.heatwave;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature >= 28) {
                const templates = noticeTemplates.hot;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature <= 0) {
                const templates = noticeTemplates.cold;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.temperature <= 5) {
                const templates = noticeTemplates.chilly;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // Í∞ïÏàòÎüâ Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÑ†ÌÉù
            if (weatherData.precipitation >= 20) {
                const templates = noticeTemplates.heavyRain;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.precipitation > 0) {
                if (weatherData.precipitationDescription === 'Îàà' || weatherData.precipitationDescription.includes('Îàà')) {
                    const templates = noticeTemplates.snow;
                    const selected = templates[Math.floor(Math.random() * templates.length)];
                    notices.push({ ...selected, date: dateString });
                } else {
                    const templates = noticeTemplates.rain;
                    const selected = templates[Math.floor(Math.random() * templates.length)];
                    notices.push({ ...selected, date: dateString });
                }
            }
            
            // ÌíçÏÜç Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÑ†ÌÉù
            if (weatherData.windSpeed >= 14) {
                const templates = noticeTemplates.strongWind;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            } else if (weatherData.windSpeed >= 10) {
                const templates = noticeTemplates.wind;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // ÏäµÎèÑ Í∏∞Î∞ò Í≥µÏßÄÏÇ¨Ìï≠ ÏÑ†ÌÉù (85% Ïù¥ÏÉÅÏùº ÎïåÎßå)
            if (weatherData.humidity >= 85) {
                const templates = noticeTemplates.humid;
                const selected = templates[Math.floor(Math.random() * templates.length)];
                notices.push({ ...selected, date: dateString });
            }
            
            // ÌäπÎ≥ÑÌïú Ï°∞Í±¥Ïù¥ ÏóÜÏúºÎ©¥ Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±ÌïòÏßÄ ÏïäÏùå
            if (notices.length === 0) {
                // ÌèâÏÉÅÏãúÏóêÎäî Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÏÉùÏÑ±ÌïòÏßÄ ÏïäÏùå
                return [];
            }
            
            // Ïö∞ÏÑ†ÏàúÏúÑÏóê Îî∞Îùº Ï†ïÎ†¨ÌïòÍ≥† ÏµúÎåÄ 3Í∞úÍπåÏßÄÎßå Î∞òÌôò
            return notices.sort((a, b) => a.priority - b.priority).slice(0, 3);
        }
        
        // Ï†ÑÏ≤¥ ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïã§Ìñâ
        async function runWorkflow() {
            if (!selectedSchool?.ORG_RDNMA) {
                showResponse('Î®ºÏ†Ä ÌïôÍµêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!', 'error');
                return;
            }
            
            showResponse('ÌïôÍµê ‚Üí ÏúÑÏπò ‚Üí ÎÇ†Ïî® ‚Üí Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ± ÌîÑÎ°úÏÑ∏Ïä§Î•º ÏãúÏûëÌï©ÎãàÎã§...', 'loading');
            
            try {
                // 2Îã®Í≥Ñ: ÏúÑÏπò Ï†ïÎ≥¥ Ï°∞Ìöå
                updateStep(2, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const locationResponse = await fetch(`${SUPABASE_URL}/functions/v1/geocode-address`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: selectedSchool.ORG_RDNMA })
                });

                const locationResult = await locationResponse.json();
                
                if (!locationResponse.ok || !locationResult.success) {
                    throw new Error('ÏúÑÏπò Ï†ïÎ≥¥ Ï°∞Ìöå Ïã§Ìå®: ' + (locationResult.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
                locationData = locationResult.location;
                displayLocationInfo(locationData);
                updateStep(2, 'completed');
                updateStep(3, 'active');
                
                // 3Îã®Í≥Ñ: ÎÇ†Ïî® Ï†ïÎ≥¥ Ï°∞Ìöå
                updateStep(3, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const weatherResponse = await fetch(`${SUPABASE_URL}/functions/v1/get-weather-by-grid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lat: locationData.latitude,
                        lng: locationData.longitude,
                        address: selectedSchool.SCHUL_NM
                    })
                });

                const weatherResult = await weatherResponse.json();
                
                if (!weatherResponse.ok || !weatherResult.success) {
                    throw new Error('ÎÇ†Ïî® Ï†ïÎ≥¥ Ï°∞Ìöå Ïã§Ìå®: ' + (weatherResult.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
                weatherData = weatherResult.weather;
                displayWeatherInfo(weatherData);
                updateStep(3, 'completed');
                updateStep(4, 'active');
                
                // 4Îã®Í≥Ñ: Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±
                updateStep(4, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const generatedNotices = generateWeatherNotices(weatherData);
                
                if (generatedNotices && generatedNotices.length > 0) {
                    displayNotices(generatedNotices);
                    updateStep(4, 'completed');
                    showResponse('‚úÖ Ï†ÑÏ≤¥ ÌîÑÎ°úÏÑ∏Ïä§ ÏôÑÎ£å!\nÎÇ†Ïî® ÏÉÅÌô©Ïóê ÎßûÎäî Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.', 'success');
                } else {
                    // Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÄ ÎÇ†Ïî®
                    displayNoNoticeMessage();
                    updateStep(4, 'completed');
                    showResponse('‚úÖ Ï†ÑÏ≤¥ ÌîÑÎ°úÏÑ∏Ïä§ ÏôÑÎ£å!\nÏò§ÎäòÏùÄ ÌäπÎ≥ÑÌïú ÎÇ†Ïî® Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏùÄ ÎÇ†Ïî®ÏûÖÎãàÎã§.', 'success');
                }
                
            } catch (error) {
                showResponse(`‚ùå ÌîÑÎ°úÏÑ∏Ïä§ Ïã§Ìñâ Ï§ë Ïò§Î•ò!\n\n${error.message}`, 'error');
                console.error('Workflow error:', error);
            }
        }
        
        // ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ï¥àÍ∏∞Ìôî
        function resetWorkflow() {
            document.getElementById('school-search').value = '';
            hideSchoolSuggestions();
            
            selectedSchool = null;
            locationData = null;
            weatherData = null;
            
            document.getElementById('selected-school').style.display = 'none';
            document.getElementById('location-info').style.display = 'none';
            document.getElementById('weather-info').style.display = 'none';
            document.getElementById('notices-container').style.display = 'none';
            document.getElementById('response-area').style.display = 'none';
            
            document.getElementById('run-workflow').disabled = true;
            
            updateStep(1, 'active');
        }
        
        // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÏûêÎèôÏôÑÏÑ± Ïà®Í∏∞Í∏∞
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#school-search') && !e.target.closest('#school-suggestions')) {
                hideSchoolSuggestions();
            }
        });
    </script>
</body>
</html>
